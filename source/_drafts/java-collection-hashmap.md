---
title: Java集合之HashMap
tags:
- Java
---

<center>
    <img src="../images/java/java_collections_overview.png" width="400"/>
</center>



```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```
1、为什么要右移？
这里的 h >>> 16 就是将哈希值h无符号右移16位。这样做的主要原因是为了在数组长度不够大时，也可以实现较好的分布，从而减少碰撞的概率。这是因为如果数组长度不够大，那么用到的其实只有哈希值的低位，高位并未参与运算。通过右移16位，将高位和低位进行了混合，从而使得低位也包含了高位的一部分信息，可以实现更好的分布。
此外，右移运算的效率非常高，因此在性能上也不会带来太大的影响。


2、hashmap内部什么情况下会转化成树？

HashMap的内部在以下情况下会转化为树：

+ 当HashMap中的某个桶（bucket）中的节点数量超过8个时，会将链表转化为红黑树。这是为了提高查询效率，因为链表的查询时间复杂度是O(n)，而红黑树的查询时间复杂度是O(logn)。
+ 当红黑树中的节点数量少于6个时，会将红黑树转换回链表。这是因为在元素数量较少的情况下，链表的效率可能会更高。


这种设计主要是为了在保证查询效率的同时，也能够尽可能地节省内存空间。