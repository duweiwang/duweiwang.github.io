<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangduwei.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="è€å¿ƒå’ŒåšæŒ">
<meta property="og:type" content="website">
<meta property="og:title" content="è“è‰²çš„ç¬”è®°æœ¬">
<meta property="og:url" content="https://wangduwei.top/archives/page/4/index.html">
<meta property="og:site_name" content="è“è‰²çš„ç¬”è®°æœ¬">
<meta property="og:description" content="è€å¿ƒå’ŒåšæŒ">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wangduwei">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wangduwei.top/archives/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>è“è‰²çš„ç¬”è®°æœ¬</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9f3c7bb2232e1e3fda4c019e4a4406c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="è“è‰²çš„ç¬”è®°æœ¬" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">è“è‰²çš„ç¬”è®°æœ¬</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">è®°å½•å­¦ä¹ å†…å®¹</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/kotlin-lang-use-mutable-collection.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kotlin-lang-use-mutable-collection.html" class="post-title-link" itemprop="url">Effective Kotlin-56ï¼šè€ƒè™‘ä½¿ç”¨å¯å˜é›†åˆ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-20 08:47:24" itemprop="dateCreated datePublished" datetime="2021-11-20T08:47:24+08:00">2021-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ä¸ä¸å¯å˜é›†åˆç›¸æ¯”ï¼Œä½¿ç”¨å¯å˜é›†åˆæœ€å¤§çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½æ›´å¿«ã€‚å‘ä¸å¯å˜é›†åˆæ·»åŠ å…ƒç´ éœ€è¦æ–°å»ºé›†åˆå†æ‹·è´æ‰€æœ‰å…ƒç´ ï¼Œä¸‹é¢æ˜¯kotlinæ ‡å‡†åº“ç°åœ¨çš„å®ç°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">plus</span><span class="params">(element: <span class="type">T</span>)</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> Collection) <span class="keyword">return</span> <span class="keyword">this</span>.plus(element)</span><br><span class="line">    <span class="keyword">val</span> result = ArrayList&lt;T&gt;()</span><br><span class="line">    result.addAll(<span class="keyword">this</span>)</span><br><span class="line">    result.add(element)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“é›†åˆå¾ˆå¤§æ—¶ï¼Œæ‹·è´æ“ä½œå°±æ¯”è¾ƒè€—æ€§èƒ½äº†ã€‚æ‰€ä»¥å¯¹äºéœ€è¦æ·»åŠ å…ƒç´ çš„é›†åˆä½¿ç”¨å¯å˜é›†åˆæ€§èƒ½æ›´å¥½ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸å¯å˜é›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯å¯¹äºä¸éœ€è¦åŒæ­¥çš„å±€éƒ¨å˜é‡æ¥è¯´åˆ™ä¸é€‚ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯¹äºå±€éƒ¨å¤„ç†ï¼Œä½¿ç”¨å¯å˜é›†åˆé€šå¸¸æ›´æœ‰æ„ä¹‰ã€‚è¿™ä¸ªäº‹å®å¯ä»¥åœ¨æ ‡å‡†åº“ä¸­åæ˜ å‡ºæ¥ï¼Œåœ¨æ ‡å‡†åº“ä¸­ï¼Œæ‰€æœ‰çš„é›†åˆå¤„ç†å‡½æ•°éƒ½æ˜¯ä½¿ç”¨å¯å˜é›†åˆå†…éƒ¨å®ç°çš„:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">map</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    transform: (<span class="type">T</span>) -&gt; <span class="type">R</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;R&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> size =</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">is</span> Collection&lt;*&gt;) <span class="keyword">this</span>.size <span class="keyword">else</span> <span class="number">10</span></span><br><span class="line">    <span class="keyword">val</span> destination = ArrayList&lt;R&gt;(size)</span><br><span class="line">    <span class="keyword">for</span> (item <span class="keyword">in</span> <span class="keyword">this</span>)</span><br><span class="line">        destination.add(transform(item))</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä¸æ˜¯ä¸å¯å˜é›†åˆï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is not how map is implemented</span></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">map</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    transform: (<span class="type">T</span>) -&gt; <span class="type">R</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;R&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> destination = listOf&lt;R&gt;()</span><br><span class="line">    <span class="keyword">for</span> (item <span class="keyword">in</span> <span class="keyword">this</span>)</span><br><span class="line">        destination += transform(item)</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ€»ç»“ï¼š<br>å¦‚æœæ˜¯å¢åŠ å…ƒç´ ï¼Œå¯å˜é›†åˆæ˜¯å¾ˆå¿«çš„ï¼Œè€Œä¸å¯å˜é›†åˆåˆ™ç»™æˆ‘ä»¬ç»™å¤šçš„æ§åˆ¶ï¼ŒçŸ¥é“é›†åˆæ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚ä½†å¯¹äºæœ¬åœ°ä½œç”¨åŸŸæ¥è®²ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ç§æ§åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨å¯å˜é›†åˆæ›´å¥½ã€‚å°¤å…¶åœ¨ä¸€äº›å·¥å…·ç±»ï¼Œæ’å…¥æ“ä½œå¯èƒ½å¾ˆé¢‘ç¹ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/kotlin-lang-inline-func-param.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kotlin-lang-inline-func-param.html" class="post-title-link" itemprop="url">Effective Kotlin-48ï¼šä¸ºå‚æ•°åŒ…å«å‡½æ•°çš„æ–¹æ³•å†…è”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-09 21:57:29" itemprop="dateCreated datePublished" datetime="2021-11-09T21:57:29+08:00">2021-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>7.7k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†å‡ ä¹æ‰€æœ‰çš„Kotlinæ ‡å‡†åº“é‡Œé¢çš„é«˜é˜¶å‡½æ•°éƒ½æ˜¯inlineç±»å‹çš„ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">repeat</span><span class="params">(times: <span class="type">Int</span>, action: (<span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until times) &#123;</span><br><span class="line">        action(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">map</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    transform: (<span class="type">T</span>) -&gt; <span class="type">R</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;R&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> mapTo(</span><br><span class="line">        ArrayList&lt;R&gt;(collectionSizeOrDefault(<span class="number">10</span>)),</span><br><span class="line">        transform</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> filterTo(ArrayList&lt;T&gt;(), predicate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å‡½æ•°çš„è°ƒç”¨åœ¨ç¼–è¯‘æ—¶ä¼šè¢«å±•å¼€åˆ°è°ƒç”¨å¤„ã€‚å¦‚ä¸‹æ‰€ç¤º:<code>repeat</code>å‡½æ•°ä¼šè¢«å®ƒæœ¬èº«çš„å‡½æ•°ä½“æ›¿æ¢æ‰ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">10</span>) &#123;</span><br><span class="line">    print(it)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//â†“ â†“ â†“ â†“ â†“ â†“ â†“ â†“ â†“ â†“ â†“ â†“</span></span><br><span class="line"><span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until <span class="number">10</span>) &#123;</span><br><span class="line">    print(index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬çš„å‡½æ•°è°ƒç”¨é€šå¸¸æ˜¯ï¼šè·³è¿›å‡½æ•°ä½“ï¼Œæ‰§è¡Œä»£ç ï¼Œç„¶åè·³å‡ºå‡½æ•°ä½“ï¼Œå›åˆ°è°ƒç”¨ç‚¹ã€‚è€Œç”¨å‡½æ•°ä½“æ›¿æ¢å‡½æ•°è°ƒç”¨æ˜¯ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æœ‰ä»¥ä¸‹ä¸€äº›ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç±»å‹å‚æ•°å…·ä½“åŒ–</li>
<li>å‚æ•°åŒ…å«å‡½æ•°çš„æ–¹æ³•å†…è”åæ‰§è¡Œæ›´å¿«</li>
<li>ä¸å…è®¸éæœ¬åœ°çš„returnè¯­å¥</li>
</ul>
<p>ä½¿ç”¨inlineæ ‡è¯†ç¬¦ä¹Ÿä¼šæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä¸‹é¢ğŸ‘‡ğŸ»æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹å®ƒçš„ä¼˜ç¼ºç‚¹ï¼š</p>
<h5 id="ä¸€ã€ç±»å‹å‚æ•°å…·ä½“åŒ–ï¼š"><a href="#ä¸€ã€ç±»å‹å‚æ•°å…·ä½“åŒ–ï¼š" class="headerlink" title="ä¸€ã€ç±»å‹å‚æ•°å…·ä½“åŒ–ï¼š"></a>ä¸€ã€ç±»å‹å‚æ•°å…·ä½“åŒ–ï¼š</h5><p>æ—©æœŸçš„Javaç‰ˆæœ¬ä¸æ”¯æŒæ³›å‹ï¼Œåœ¨2004å¹´çš„J2SE-5.0æ‰æ”¯æŒã€‚ç”±äºæ³›å‹ä¼šåœ¨ç¼–è¯‘æœŸé—´è¢«æ“¦é™¤ï¼Œæ‰€ä»¥åœ¨å­—èŠ‚ç å±‚é¢æ˜¯ä¸å­˜åœ¨çš„ã€‚ä¾‹å¦‚ï¼š<code>List&lt;Int&gt;</code> ç¼–è¯‘åæˆä¸º <code>List</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯Listå®ä¾‹ï¼Œè€Œä¸ç”¨æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ª<code>List&lt;Int&gt;</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">any <span class="keyword">is</span> List&lt;<span class="built_in">Int</span>&gt; <span class="comment">// Error</span></span><br><span class="line">any <span class="keyword">is</span> List&lt;*&gt; <span class="comment">// OK</span></span><br></pre></td></tr></table></figure>

<center>
    <img src="../images/kotlin_type_check.png" width="500"/>
</center>

<p>ç”±äºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬ä¸èƒ½æ“ä½œç±»å‹å‚æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">printTypeName</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(T::<span class="keyword">class</span>.simpleName) <span class="comment">// ERROR</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å†…è”å‡½æ•°æˆ‘ä»¬å¯ä»¥çªç ´è¿™ç§é™åˆ¶ã€‚ç”±äºå‡½æ•°è°ƒç”¨è¢«å‡½æ•°ä½“æ›¿æ¢ï¼Œé€šè¿‡ä½¿ç”¨<code>reified</code>ä¿®é¥°ç¬¦ï¼Œæ³›å‹è¢«çœŸå®çš„ç±»å‹å‚æ•°æ›¿æ¢ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">printTypeName</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(T::<span class="keyword">class</span>.simpleName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line">printTypeName&lt;<span class="built_in">Int</span>&gt;()    <span class="comment">//â†’print(Int::class.simpleName) // Int</span></span><br><span class="line">printTypeName&lt;<span class="built_in">Char</span>&gt;()   <span class="comment">//â†’print(Char::class.simpleName)// Char</span></span><br><span class="line">printTypeName&lt;String&gt;() <span class="comment">//â†’print(String::class.simpleName)// String</span></span><br></pre></td></tr></table></figure>

<p><code>reified</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ä¿®é¥°ç¬¦ï¼Œä¾‹å¦‚æ ‡å‡†åº“é‡Œé¢çš„<code>filterIsInstance</code>ç”¨æ¥è¿‡æ»¤æŸä¸€ç§ç±»å‹çš„å…ƒç´ ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> employees: List&lt;Any&gt; =</span><br><span class="line">    listOf(Worker(), Manager(), Worker())</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> workers: List&lt;Worker&gt; =</span><br><span class="line">    employees.filterIsInstance&lt;Worker&gt;()</span><br></pre></td></tr></table></figure>

<p>å®ƒç»å¸¸è¢«ç”¨åœ¨æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç åº“æˆ–å·¥å…·ç±»ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯ä½¿ç”¨Gsonåº“å®ç°çš„é€šç”¨å‡½æ•°ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä¾èµ–æ³¨å…¥å’Œæ¨¡å—ç”³æ˜ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T : Any&gt;</span> String.<span class="title">fromJsonOrNull</span><span class="params">()</span></span>: T? =</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        gson.fromJson(json, T::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: JsonSyntaxException) &#123;</span><br><span class="line">        <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"><span class="keyword">val</span> user: User? = userAsText.fromJsonOrNull()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin module declaration</span></span><br><span class="line"><span class="keyword">val</span> myModule = module &#123;</span><br><span class="line">    single &#123; Controller(<span class="keyword">get</span>()) &#125; <span class="comment">// get is reified</span></span><br><span class="line">    single &#123; BusinessService() &#125; <span class="comment">// get is reified</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin injection</span></span><br><span class="line"><span class="keyword">val</span> service: BusinessService <span class="keyword">by</span> inject()</span><br><span class="line"><span class="comment">// inject is reified</span></span><br></pre></td></tr></table></figure>

<h5 id="äºŒã€å‡½æ•°ç±»å‹çš„å‚æ•°å†…è”åæ‰§è¡Œæ›´å¿«"><a href="#äºŒã€å‡½æ•°ç±»å‹çš„å‚æ•°å†…è”åæ‰§è¡Œæ›´å¿«" class="headerlink" title="äºŒã€å‡½æ•°ç±»å‹çš„å‚æ•°å†…è”åæ‰§è¡Œæ›´å¿«"></a>äºŒã€å‡½æ•°ç±»å‹çš„å‚æ•°å†…è”åæ‰§è¡Œæ›´å¿«</h5><p>æ›´ç¡®åˆ‡çš„è®²ï¼ŒçŸ­å°çš„å‡½æ•°å†…è”ä¼šæ›´å¿«ï¼Œå®ƒæ— éœ€è·³è½¬æ‰§è¡Œå’Œè·Ÿè¸ªè°ƒç”¨æ ˆã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ ‡å‡†åº“é‡Œé¢å¾ˆå¤šå°å‡½æ•°éƒ½æ˜¯inlineç±»å‹çš„åŸå› ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">(message: <span class="type">Any</span>?)</span></span> &#123;</span><br><span class="line">    System.<span class="keyword">out</span>.print(message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ–¹æ³•æ²¡æœ‰å‡½æ•°ç±»å‹çš„å‚æ•°æ—¶ï¼Œæ²¡å¿…è¦å†…è”ä¸”IntelliJä¼šç»™å‡ºä»¥ä¸‹æç¤ºâš ï¸ï¼š</p>
<center>
    <img src="../images/kotlin_intelij_waring_inline.jpeg" width="500"/>
</center>


<p>è¦ç†è§£å…¶ä¸­çš„åŸå› ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£å°†å‡½æ•°ä½œä¸ºå¯¹è±¡è¿›è¡Œæ“ä½œçš„é—®é¢˜æ˜¯ä»€ä¹ˆã€‚è¿™äº›ç±»å‹çš„å¯¹è±¡(ä½¿ç”¨å‡½æ•°å­—é¢é‡åˆ›å»º)éœ€è¦ä»¥æŸç§æ–¹å¼ä¿å­˜ã€‚åœ¨Kotlin/JVMä¸Šï¼Œéœ€è¦ä½¿ç”¨JVMåŒ¿åç±»æˆ–æ™®é€šç±»åˆ›å»ºä¸€äº›å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸‹é¢çš„lambdaè¡¨è¾¾å¼:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> lambda: () -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†ä¼šè¢«ç¼–è¯‘ä¸ºä¸€ä¸ªç±»ã€‚æˆ–JVMåŒ¿åç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line">Function0&lt;Unit&gt; lambda = <span class="keyword">new</span> Function0&lt;Unit&gt;() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Unit <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¢«ç¼–è¯‘æˆä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œè¢«å®šä¹‰åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="comment">// Additional class in separate file</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>$<span class="title">lambda</span> <span class="keyword">implements</span> <span class="title">Function0</span> &lt; <span class="title">Unit</span> &gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Unit <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line">Function0 lambda = <span class="keyword">new</span> Test$lambda();</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ç§æ–¹å¼æ²¡æœ‰ç‰¹åˆ«å¤§çš„åŒºåˆ«ã€‚</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œè¿™ä¸ªå‡½æ•°ç±»å‹è¢«è½¬æ¢æˆFunction0ç±»å‹ã€‚åœ¨Kotlinä¸­ï¼Œæ— å‚ç±»å‹ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢æˆFunction0ï¼ŒåŒç†å•å‚æ•°ï¼Œä¸¤å‚æ•°è½¬æ¢æˆFunction1, Function2,Function3ç­‰</p>
<ul>
<li>()-&gt;Unit ç¼–è¯‘æˆ Function0<Unit></li>
<li>()-&gt;Int ç¼–è¯‘æˆ Function0<Int></li>
<li>(Int)-&gt;Int ç¼–è¯‘æˆ Function1&lt;Int, Int&gt;</li>
<li>(Int, Int)-&gt;Int ç¼–è¯‘æˆ Function2&lt;Int, Int, Int&gt;</li>
</ul>
<p>è¿™äº›æ‰€æœ‰çš„æ¥å£éƒ½æ˜¯Kotlinç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚ä½ ä¸èƒ½åœ¨Kotliné‡Œæ˜¾ç¤ºçš„ä½¿ç”¨ä»–ä»¬ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æŒ‰éœ€ç”Ÿæˆçš„ï¼Œè€Œåº”è¯¥ä½¿ç”¨å‡½æ•°ç±»å‹ã€‚çŸ¥é“å‡½æ•°ç±»å‹åªæ˜¯æ¥å£ä¸ºä½ å¼€å¯äº†å¾ˆå¤šçš„å¯èƒ½æ€§ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnClickListener</span> : <span class="type"></span></span>() -&gt; <span class="built_in">Unit</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">invoke</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚åœ¨<em>é«˜æ•ˆKotlin-47</em>ä¸­æ‰€è¿°ï¼šé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼ŒæŠŠå‡½æ•°ä½“åŒ…è£…æˆå¯¹è±¡æ‹–æ…¢ä»£ç ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸‹é¢çš„ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ªæ›´å¿«ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">repeat</span><span class="params">(times: <span class="type">Int</span>, action: (<span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until times) &#123;</span><br><span class="line">        action(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">repeatNoinline</span><span class="params">(times: <span class="type">Int</span>, action: (<span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until times) &#123;</span><br><span class="line">        action(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å·®å¼‚æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†åœ¨ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­ä¸­å¾ˆå°‘æœ‰æ˜¾è‘—å·®å¼‚ã€‚æˆ‘ä»¬æŠŠæµ‹è¯•ç”¨ä¾‹è®¾è®¡ä¸€ä¸‹ï¼Œæ”¾å¤§è¿™ç§å·®å¼‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Benchmark</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nothingInline</span><span class="params">(blackhole: <span class="type">Blackhole</span>)</span></span> &#123;</span><br><span class="line">    repeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">        blackhole.consume(it)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Benchmark</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nothingNoninline</span><span class="params">(blackhole: <span class="type">Blackhole</span>)</span></span> &#123;</span><br><span class="line">    noinlineRepeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">        blackhole.consume(it)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªåœ¨æˆ‘ä»¬ç”µè„‘å¹³å‡è¿è¡Œ189msã€‚ç¬¬äºŒä¸ªå¹³å‡447msã€‚è¿™ç§å·®è·ä½“ç°åœ¨ï¼šç¬¬ä¸€ä¸ªä¾‹å­è¿­ä»£è°ƒç”¨ç©ºå‡½æ•°ã€‚ç¬¬äºŒä¸ªä¾‹å­è¿­ä»£è°ƒç”¨å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è°ƒç”¨ä¸€ä¸ªç©ºå‡½æ•°ã€‚è¿™é‡Œä½¿ç”¨äº†é¢å¤–çš„å¯¹è±¡ã€‚</p>
<p>çœ‹ä¸€ä¸ªæ›´å…¸å‹çš„ä¾‹å­ã€‚æˆ‘ä»¬æœ‰5000ä¸ªäº§å“ï¼Œè®¡ç®—æˆ‘ä»¬è´­ä¹°ç‰©å“çš„ä»·æ ¼ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users.filter &#123; it.bought &#125;.sumByDouble &#123; it.price &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘çš„æœºå™¨ä¸Šå¹³å‡è€—æ—¶38msã€‚å¦‚æœfilterå’ŒsumByDoubleä¸å†…è”è€—æ—¶å¤šå°‘å‘¢ï¼Ÿå¹³å‡42msï¼çœ‹èµ·æ¥ä¸å¤šï¼Œä½†æ¯æ¬¡è°ƒç”¨ä¹Ÿæœ‰10%çš„å·®å¼‚ã€‚</p>
<p>å†…è”å’Œéå†…è”å‡½æ•°æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå½“æˆ‘ä»¬åœ¨å‡½æ•°å­—é¢é‡é‡Œæ•è·å˜é‡æ—¶ã€‚å˜é‡è¢«ä½¿ç”¨æ—¶éœ€è¦è¢«åŒ…è£…æˆå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> l = <span class="number">1L</span></span><br><span class="line">noinlineRepeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">    l += it</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸èƒ½ç›´æ¥åœ¨éå†…è”lambdaä¸­ä½¿ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦è¢«åŒ…è£…æˆå¼•ç”¨å¯¹è±¡ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = Ref.LongRef()</span><br><span class="line">a.element = <span class="number">1L</span></span><br><span class="line">noinlineRepeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">    a.element = a.element + it</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«å¾ˆå¤§æ˜¯å› ä¸ºï¼Œé€šå¸¸è¿™ä¸ªå¯¹è±¡ä¼šè¢«ä½¿ç”¨å¾ˆå¤šæ¬¡ï¼Œä¸Šé¢ä»£ç ä¸­çš„aå˜é‡ä½¿ç”¨äº†ä¸¤æ¬¡ã€‚å› æ­¤ï¼Œé¢å¤–çš„å¯¹è±¡è°ƒç”¨2*100_000_000ã€‚å†çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ğŸ‘‡ğŸ»ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Benchmark</span></span><br><span class="line"><span class="comment">// On average 30 ms</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nothingInline</span><span class="params">(blackhole: <span class="type">Blackhole</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> l = <span class="number">0L</span></span><br><span class="line">    repeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">        l += it</span><br><span class="line">    &#125;</span><br><span class="line">    blackhole.consume(l)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Benchmark</span></span><br><span class="line"><span class="comment">// On average 274 ms</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nothingNoninline</span><span class="params">(blackhole: <span class="type">Blackhole</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> l = <span class="number">0L</span></span><br><span class="line">    noinlineRepeat(<span class="number">100_000_000</span>) &#123;</span><br><span class="line">        l += it</span><br><span class="line">    &#125;</span><br><span class="line">    blackhole.consume(l)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªåœ¨æˆ‘ç”µè„‘è¿è¡Œ30msï¼Œç¬¬äºŒä¸ª274msã€‚å·®è·çš„åŸå› æ˜¯ï¼Œå‡½æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ¬åœ°å˜é‡éœ€è¦è¢«åŒ…è£…ã€‚å°çš„å½±å“ç´¯è®¡æ”¾å¤§äº†ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æœ‰å‡½æ•°ç±»å‹å‚æ•°çš„æ–¹æ³•è¢«å¦‚ä½•ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬å®šä¹‰è¿™ç§å‡½æ•°æ—¶ï¼Œæœ€å¥½å†…è”ä¸€ä¸‹ã€‚è¿™ä¹Ÿæ˜¯æ ‡å‡†åº“ç»å¸¸è¿™ä¹ˆå†™çš„åŸå› ã€‚</p>
<h5 id="ä¸‰ã€ä¸å…è®¸éæœ¬åœ°è¿”å›"><a href="#ä¸‰ã€ä¸å…è®¸éæœ¬åœ°è¿”å›" class="headerlink" title="ä¸‰ã€ä¸å…è®¸éæœ¬åœ°è¿”å›"></a>ä¸‰ã€ä¸å…è®¸éæœ¬åœ°è¿”å›</h5><p>å‰é¢å®šä¹‰çš„<code>repeatNoninline</code>åƒæ˜¯ä¸€ä¸ªæ§åˆ¶ç»“æ„ï¼Œæ‹¿å®ƒå’Œifè¯­å¥æˆ–forå¾ªç¯å¯¹æ¯”ä¸€ä¸‹ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">    print(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span>) &#123;</span><br><span class="line">    print(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repeatNoninline(<span class="number">10</span>) &#123;</span><br><span class="line">    print(it)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜æ˜¾çš„åŒºåˆ«æ˜¯ï¼Œå†…éƒ¨ä¸èƒ½è¿”å›</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    repeatNoinline(<span class="number">10</span>) &#123;</span><br><span class="line">        print(it)</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// ERROR: Not allowed</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å‡½æ•°å­—é¢é‡ç¼–è¯‘çš„ç»“æœã€‚å½“æˆ‘ä»¬çš„ä»£ç å¤„äºå¦å¤–ä¸€ä¸ªç±»æ—¶ï¼Œä¸èƒ½ä»mainå‡½æ•°è¿”å›ã€‚ä½†æ˜¯ï¼Œå½“ä½¿ç”¨å†…è”æ—¶ï¼Œå°±æ²¡é™åˆ¶ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    repeat(<span class="number">10</span>) &#123;</span><br><span class="line">        print(it)</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">// OK</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾—ç›Šäºæ­¤ï¼Œå‡½æ•°å¯ä»¥çœ‹èµ·æ¥æ›´åƒæ§åˆ¶ç»“æ„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getSomeMoney</span><span class="params">()</span></span>: Money? &#123;</span><br><span class="line">    repeat(<span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> money = searchForMoney()</span><br><span class="line">        <span class="keyword">if</span> (money != <span class="literal">null</span>) <span class="keyword">return</span> money</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h5 id="å››ã€å†…è”ä¿®é¥°ç¬¦çš„ç¼ºé™·"><a href="#å››ã€å†…è”ä¿®é¥°ç¬¦çš„ç¼ºé™·" class="headerlink" title="å››ã€å†…è”ä¿®é¥°ç¬¦çš„ç¼ºé™·"></a>å››ã€å†…è”ä¿®é¥°ç¬¦çš„ç¼ºé™·</h5><p>inlineå¾ˆæœ‰ç”¨ï¼Œä½†ä¸åº”è¯¥éšå¤„ä½¿ç”¨ã€‚æœ‰äº›æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨ã€‚å†æ¥çœ‹çœ‹æœ€é‡è¦çš„é™åˆ¶ã€‚</p>
<ul>
<li>å†…è”å‡½æ•°ä¸èƒ½é€’å½’ï¼Œå¦åˆ™è°ƒç”¨å±•å¼€å°†æ— é™å¾ªç¯ã€‚å‘¨æœŸæ€§å¾ªç¯å°¤å…¶å±é™©ï¼Œå› ä¸ºIntellijä¸æŠ¥é”™ï¼š</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">    b()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">c</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å†…è”å‡½æ•°ä¸èƒ½ä½¿ç”¨å¯è§æ€§çº¦æŸçš„å…ƒç´ </li>
</ul>
<p>åœ¨<code>public inline fun</code>ä¸­ä¸èƒ½ä½¿ç”¨private ã€internalä¿®é¥°çš„å‡½æ•°æˆ–å±æ€§</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> reader = Reader() <span class="comment">// Error</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒä¸èƒ½ç”¨äºéšè—å®ç°ï¼Œå¹¶ä¸”å¾ˆå°‘åœ¨ç±»ä¸­ä½¿ç”¨ã€‚</p>
<ul>
<li>å†…è”å‡½æ•°ä½¿ä»£ç è†¨èƒ€</li>
</ul>
<p>å®šä¹‰ä¸€ä¸ªæ‰“å°3çš„å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">printThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ä¸‰æ¬¡ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    printThree()</span><br><span class="line">    printThree()</span><br><span class="line">    printThree()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå®šä¹‰ä¸‹é¢å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threeThreePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    threePrintThree()</span><br><span class="line">    threePrintThree()</span><br><span class="line">    threePrintThree()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threeThreeThreePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    threeThreePrintThree()</span><br><span class="line">    threeThreePrintThree()</span><br><span class="line">    threeThreePrintThree()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹å®ƒä»¬çš„ç¼–è¯‘ç»“æœï¼Œå‰ä¸¤ä¸ªè¿˜èƒ½çœ‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">printThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åä¸¤ä¸ªï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threeThreePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">threeThreeThreePrintThree</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)    </span><br><span class="line"> ...</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å†…è”å‡½æ•°çš„å¼Šç«¯ï¼šè¿‡åº¦ä½¿ç”¨æ—¶ä»£ç è†¨èƒ€ä¸¥é‡ã€‚</p>
<h5 id="äº”ã€crossinline-å’Œnoinline"><a href="#äº”ã€crossinline-å’Œnoinline" class="headerlink" title="äº”ã€crossinline å’Œnoinline"></a>äº”ã€crossinline å’Œnoinline</h5><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å†…è”ä¸€ä¸ªå‡½æ•°ï¼Œç”±äºæŸäº›åŸå› ï¼Œä¸èƒ½å†…è”å…¨éƒ¨çš„å‡½æ•°ç±»å‹å‚æ•°ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä¿®é¥°ç¬¦ï¼š</p>
<p>crossinlineï¼šç”¨äºå†…è”å‡½æ•°çš„å‚æ•°ï¼Œè¡¨ç¤ºæ­¤å‚æ•°å†…è”èŒƒå›´æ‰©å¤§ã€‚å¯¹å†…è”å‡½æ•°å†…éƒ¨çš„lambdaç”Ÿæ•ˆï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">hello</span><span class="params">(postAction:()-&gt;<span class="type">Unit</span>)</span></span>&#123;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    runOnUiThread &#123; </span><br><span class="line">        postAction()</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>noinlineï¼šç”¨äºå†…è”å‡½æ•°çš„å‚æ•°ï¼Œè¡¨ç¤ºæ­¤å‚æ•°ä¸èƒ½è¢«å†…è”ã€‚å¯ä»¥å±€éƒ¨æ€§å…³é—­å†…è”ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">requestNewToken</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    hasToken: <span class="type">Boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">crossinline</span> onRefresh: () -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">noinline</span> onGenerate: () -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasToken) &#123;</span><br><span class="line">        httpCall(<span class="string">&quot;get-token&quot;</span>, onGenerate) <span class="comment">// We must use </span></span><br><span class="line">        <span class="comment">// noinline to pass function as an argument to a</span></span><br><span class="line">        <span class="comment">// function that is not inlined</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        httpCall(<span class="string">&quot;refresh-token&quot;</span>) &#123;</span><br><span class="line">            onRefresh() <span class="comment">// We must use crossinline to </span></span><br><span class="line">            <span class="comment">// inline function in a context where </span></span><br><span class="line">            <span class="comment">// non-local return is not allowed</span></span><br><span class="line">            onGenerate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">httpCall</span><span class="params">(url: <span class="type">String</span>, callback: () -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èƒ½è®°ä½è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æœ€å¥½ï¼Œè®°ä¸ä½ä¹Ÿæ²¡äº‹ï¼ŒIntelliJä¼šæœ‰æç¤ºï¼š</p>
<h5 id="å…­ã€æ€»ç»“ï¼š"><a href="#å…­ã€æ€»ç»“ï¼š" class="headerlink" title="å…­ã€æ€»ç»“ï¼š"></a>å…­ã€æ€»ç»“ï¼š</h5><p>ä½¿ç”¨inlineçš„ä¸»è¦åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>ç»å¸¸è¢«ä½¿ç”¨çš„å‡½æ•°</li>
<li>å…·ä½“åŒ–çš„ç±»å‹å‚æ•°ï¼Œåƒï¼š<code>filterIsInstance</code></li>
<li>å®šä¹‰å¸¦æœ‰å‡½æ•°ç±»å‹çš„å‚æ•°çš„é¡¶å±‚å‡½æ•°ã€‚å°¤å…¶æ˜¯è¾…åŠ©å‡½æ•°ï¼Œå¦‚é›†åˆå¤„ç†ï¼ˆmapã€filterï¼‰ã€ä½œç”¨åŸŸå‡½æ•°ï¼ˆalsoã€applyã€letï¼‰ã€é¡¶å±‚å·¥å…·å‡½æ•°ï¼ˆrepeatã€runã€withï¼‰</li>
</ul>
<p>æˆ‘ä»¬å¾ˆå°‘ç”¨inlineå®šä¹‰APIï¼Œæ³¨æ„å†…è”å‡½æ•°è°ƒç”¨å†…è”å‡½æ•°çš„æƒ…æ™¯ã€‚è®°ä½ä»£ç è†¨èƒ€ã€‚</p>
<p>å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://kt.academy/article/ek-inline-functions">Effective Kotlin Item 48: Use inline modifier for functions with parameters of functional types</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/kotlin-lang-sequence.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kotlin-lang-sequence.html" class="post-title-link" itemprop="url">Effective Kotlin-51ï¼šä½¿ç”¨Sequenceä¼˜åŒ–é›†åˆæ“ä½œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-06 21:37:43" itemprop="dateCreated datePublished" datetime="2021-11-06T21:37:43+08:00">2021-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>7.9k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>ä½ å¯èƒ½å¯¹ <code>Iterable</code> å’Œ <code>Sequence</code> å‚»å‚»åˆ†ä¸æ¸…ã€‚çœ‹ä¸€ä¸‹ä»–ä»¬çš„ä»£ç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Iterable</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">iterator</span><span class="params">()</span></span>: Iterator&lt;T&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Sequence</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">iterator</span><span class="params">()</span></span>: Iterator&lt;T&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å¥½åƒåªæœ‰åå­—ä¸ä¸€æ ·-_-||ï¼Œä½†ä»–ä»¬å´æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚<code>Sequence</code>å±äºæ‡’åŠ è½½ï¼Œä¸­é—´æ“ä½œç¬¦ä¸ä¼šè§¦å‘è®¡ç®—ï¼Œä»…ä»…æ˜¯å¯¹å‰ä¸€ä¸ªSequenceçš„è£…é¥°ï¼Œåªæœ‰åœ¨é‡åˆ°toList()æˆ–count()è¿™äº›ç»ˆæ­¢æ“ä½œç¬¦æ—¶æ‰ä¼šæ‰§è¡ŒçœŸæ­£çš„è®¡ç®—å·¥ä½œã€‚è€ŒIterableæ¯ä¸€æ­¥éƒ½è¿”å›ä¸€ä¸ªæ–°çš„é›†åˆã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> filterTo(ArrayList&lt;T&gt;(), predicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Sequence<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Sequence&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> FilteringSequence(<span class="keyword">this</span>, <span class="literal">true</span>, predicate)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾ä¸­filteræ“ä½œç¬¦ä¸åšä»»ä½•è®¡ç®—æ“ä½œï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªè£…é¥°å™¨å¯¹è±¡ï¼Œåœ¨é‡åˆ°toList()æ“ä½œç¬¦æ‰æ‰§è¡Œè®¡ç®—ã€‚</p>
<center>
    <img src="../images/kotlin_sequence_operation.jpeg" width="500"/>
</center>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> seq = sequenceOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">val</span> filtered = seq.filter &#123; print(<span class="string">&quot;f<span class="variable">$it</span> &quot;</span>); it % <span class="number">2</span> == <span class="number">1</span> &#125;</span><br><span class="line">println(filtered)  <span class="comment">// FilteringSequence@...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> asList = filtered.toList()</span><br><span class="line"><span class="comment">// f1 f2 f3</span></span><br><span class="line">println(asList) <span class="comment">// [1, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> list = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">val</span> listFiltered = list</span><br><span class="line">    .filter &#123; print(<span class="string">&quot;f<span class="variable">$it</span> &quot;</span>); it % <span class="number">2</span> == <span class="number">1</span> &#125;</span><br><span class="line"><span class="comment">// f1 f2 f3</span></span><br><span class="line">println(listFiltered) <span class="comment">// [1, 3]</span></span><br></pre></td></tr></table></figure>

<h4 id="äºŒã€ä¼˜åŠ¿"><a href="#äºŒã€ä¼˜åŠ¿" class="headerlink" title="äºŒã€ä¼˜åŠ¿"></a>äºŒã€ä¼˜åŠ¿</h4><p>Sequenceçš„æƒ°æ€§æ‰§è¡Œæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¿è¯æ“ä½œçš„é¡ºåºæ€§</li>
<li>ä¿è¯æ“ä½œæ‰§è¡Œæ¬¡æ•°æœ€å°‘åŒ–</li>
<li>ä»–ä»¬å¯ä»¥æ˜¯æ— é™çš„</li>
<li>æ— éœ€æ¯ä¸€æ­¥åˆ›å»ºæ–°çš„é›†åˆ</li>
</ul>
<p>ä¸‹é¢ä¾æ¬¡è®¨è®ºä¸€ä¸‹è¿™äº›ä¼˜ç‚¹</p>
<h5 id="ä¸€ã€é¡ºåºæ€§å¾ˆé‡è¦"><a href="#ä¸€ã€é¡ºåºæ€§å¾ˆé‡è¦" class="headerlink" title="ä¸€ã€é¡ºåºæ€§å¾ˆé‡è¦"></a>ä¸€ã€é¡ºåºæ€§å¾ˆé‡è¦</h5><table>
    <tr>
        <td>ä½¿ç”¨Sequenceå¤„ç†æ•°æ®æ—¶ï¼Œæ¯ä¸ªå…ƒç´ ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ“ä½œç¬¦ã€‚è¿™æ˜¯ä¸€ç§å…ƒç´ æ¥å…ƒç´ çš„å¤„ç†æ–¹å¼ã€‚</td>
        <td>ä½¿ç”¨Iterableå¤„ç†æ•°æ®æ—¶ï¼Œæ¯ä¸ªæ“ä½œç¬¦ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ•°æ®ã€‚è¿™æ˜¯ä¸€ç§æ­¥éª¤æ¥æ­¥éª¤çš„å¤„ç†æ–¹å¼ã€‚</td>
    </tr>
     <tr>
            <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sequenceOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .filter &#123; </span><br><span class="line">        print(<span class="string">&quot;F<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it % <span class="number">2</span> == <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; </span><br><span class="line">        print(<span class="string">&quot;M<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it * <span class="number">2</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .forEach &#123; </span><br><span class="line">        print(<span class="string">&quot;E<span class="variable">$it</span>, &quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Prints: F1, M1, E2, F2, F3, M3, E6, </span></span><br></pre></td></tr></table></figure>
            </td>
            <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .filter &#123; </span><br><span class="line">        print(<span class="string">&quot;F<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it % <span class="number">2</span> == <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; </span><br><span class="line">        print(<span class="string">&quot;M<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it * <span class="number">2</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .forEach &#123; </span><br><span class="line">        print(<span class="string">&quot;E<span class="variable">$it</span>, &quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Prints: F1, F2, F3, M1, M3, E2, E6,</span></span><br></pre></td></tr></table></figure>
            </td>
        </tr>
</table>


<center>
    <img src="../images/kotlin_sequence_order.jpeg" width="500"/>
</center>

<p>å¦‚æœæˆ‘ä»¬ä¸ç”¨é›†åˆå¤„ç†å‡½æ•°ï¼Œè€Œæ˜¯ç”¨å¾ªç¯å’Œæ¡ä»¶è¯­å¥ï¼Œè¿™å’Œsequenceä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å…ƒç´ æ¥å…ƒç´ çš„å¤„ç†æ–¹å¼ã€‚è¿™ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ç¼–è¯‘å™¨åº•å±‚ä¼˜åŒ–çš„æ€è·¯ï¼šsequenceæ“ä½œå¯ä»¥è¢«ä¼˜åŒ–æˆå¾ªç¯å’Œæ¡ä»¶ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (e <span class="keyword">in</span> listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) &#123;</span><br><span class="line">    print(<span class="string">&quot;F<span class="variable">$e</span>, &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> (e % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        print(<span class="string">&quot;M<span class="variable">$e</span>, &quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> mapped = e * <span class="number">2</span></span><br><span class="line">        print(<span class="string">&quot;E<span class="variable">$mapped</span>, &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints: F1, M1, E2, F2, F3, M3, E6,</span></span><br></pre></td></tr></table></figure>


<h5 id="äºŒã€Sequenceæ‰§è¡Œæœ€å°‘çš„æ“ä½œ"><a href="#äºŒã€Sequenceæ‰§è¡Œæœ€å°‘çš„æ“ä½œ" class="headerlink" title="äºŒã€Sequenceæ‰§è¡Œæœ€å°‘çš„æ“ä½œ"></a>äºŒã€Sequenceæ‰§è¡Œæœ€å°‘çš„æ“ä½œ</h5><p>æˆ‘ä»¬æ²¡å¿…è¦æ¯ä¸€æ­¥éƒ½å¤„ç†æ•´ä¸ªé›†åˆã€‚å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ç™¾ä¸‡ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬åªéœ€è¦å‰åä¸ªï¼Œæ²¡å¿…è¦å¤„ç†åä¸ªä¹‹åçš„æ•°æ®ã€‚æ‰€ä»¥sequenceå¯ä»¥æ‰§è¡Œæœ€å°‘çš„æ“ä½œã€‚</p>
<center>
    <img src="../images/kotlin_sequence_min_op.jpeg" width="500"/>
</center>

<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<table>
     <tr>
            <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1.</span><span class="number">.10</span>).asSequence()</span><br><span class="line">    .filter &#123; </span><br><span class="line">        print(<span class="string">&quot;F<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it % <span class="number">2</span> == <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; </span><br><span class="line">        print(<span class="string">&quot;M<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it * <span class="number">2</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .find &#123; </span><br><span class="line">        it &gt; <span class="number">5</span> </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Prints: F1, M1, F2, F3, M3,</span></span><br></pre></td></tr></table></figure>
            </td>
            <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1.</span><span class="number">.10</span>)</span><br><span class="line">    .filter &#123; </span><br><span class="line">        print(<span class="string">&quot;F<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it % <span class="number">2</span> == <span class="number">1</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; </span><br><span class="line">        print(<span class="string">&quot;M<span class="variable">$it</span>, &quot;</span>); </span><br><span class="line">        it * <span class="number">2</span> </span><br><span class="line">    &#125;</span><br><span class="line">    .find &#123; </span><br><span class="line">        it &gt; <span class="number">5</span> </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Prints: </span></span><br><span class="line"><span class="comment">//F1, F2, F3, F4, F5, F6, F7, F8, F9, F10, </span></span><br><span class="line"><span class="comment">// M1, M3, M5, M7, M9,         </span></span><br></pre></td></tr></table></figure>
            </td>
        </tr>
</table>

<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰å¾ˆå¤šä¸ªæ“ä½œç¬¦ï¼Œæœ€åçš„ç»ˆæ­¢æ“ä½œç¬¦ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„æ•°æ®ï¼Œå› æ­¤sequenceæ€§èƒ½æ›´å¥½ã€‚ç±»ä¼¼çš„æ“ä½œç¬¦è¿˜æœ‰ï¼š<code>first</code>, <code>find</code>, <code>take</code>, <code>any</code>, <code>all</code>, <code>none</code> æˆ– <code>indexOf</code>ã€‚</p>
<h5 id="ä¸‰ã€Sequenceæ˜¯æ— é™çš„"><a href="#ä¸‰ã€Sequenceæ˜¯æ— é™çš„" class="headerlink" title="ä¸‰ã€Sequenceæ˜¯æ— é™çš„"></a>ä¸‰ã€Sequenceæ˜¯æ— é™çš„</h5><p>ç”±äºSequenceæŒ‰éœ€å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ— é™åºåˆ—ã€‚ä¸€ç§å¸¸ç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨sequenceç”Ÿæˆå™¨ <code>generateSequence</code> æˆ– <code>sequence</code> ã€‚</p>
<p><code>generateSequence</code>éœ€è¦ä¼ å¦‚ç¬¬ä¸€ä¸ªå€¼ï¼Œä»¥åŠå¦‚ä½•äº§ç”Ÿä¸‹ä¸€ä¸ªå€¼ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">generateSequence(<span class="number">1</span>) &#123; it + <span class="number">1</span> &#125;</span><br><span class="line">    .map &#123; it * <span class="number">2</span> &#125;</span><br><span class="line">    .take(<span class="number">10</span>)</span><br><span class="line">    .forEach &#123; print(<span class="string">&quot;<span class="variable">$it</span>, &quot;</span>) &#125;</span><br><span class="line"><span class="comment">// Prints: 2, 4, 6, 8, 10, 12, 14, 16, 18, 20,</span></span><br></pre></td></tr></table></figure>

<p><code>sequence</code> åˆ™ä½¿ç”¨æŒ‚èµ·å‡½æ•°æŒ‰éœ€ç”Ÿæˆæ•°æ®ã€‚åªè¦æˆ‘ä»¬éœ€è¦æ•°æ®ä»–å°±æ‰§è¡Œï¼Œä¸€ç›´åˆ°è°ƒç”¨yieldæ–¹æ³•ã€‚ç„¶åæŒ‚èµ·ç›´åˆ°ä¸‹æ¬¡å†å‘ä»–è¯·æ±‚æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ— é™ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¾‹å­ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> fibonacci: Sequence&lt;BigDecimal&gt; = sequence &#123;</span><br><span class="line">    <span class="keyword">var</span> current = <span class="number">1.</span>toBigDecimal()</span><br><span class="line">    <span class="keyword">var</span> prev = <span class="number">1.</span>toBigDecimal()</span><br><span class="line">    yield(prev)</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        yield(current)</span><br><span class="line">        <span class="keyword">val</span> temp = prev</span><br><span class="line">        prev = current</span><br><span class="line">        current += temp</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(fibonacci.take(<span class="number">10</span>).toList())</span><br><span class="line">    <span class="comment">// [1, 1, 2, 3, 5, 8, 13, 21, 34, 55]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨æ— é™åºåˆ—éœ€è¦é™åˆ¶å…ƒç´ çš„æ•°é‡ï¼Œå¦åˆ™å°†æ— é™çš„è¿è¡Œä¸‹å»ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(fibonacci.toList()) <span class="comment">// Runs forever</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†ä¸è®©å®ƒæ— é™å¾ªç¯çš„è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>take</code>é™åˆ¶å…ƒç´ æ•°é‡ï¼Œæˆ–è€…ä½¿ç”¨firstã€findã€indexOfç­‰ã€‚åœ¨ä¸é™åˆ¶æ•°é‡çš„æƒ…å†µä¸‹ï¼Œä¸è¦ä½¿ç”¨anyã€allã€noneã€‚</p>
<h5 id="å››ã€sequenceæ¯ä¸€æ­¥ä¸äº§ç”Ÿæ–°é›†åˆ"><a href="#å››ã€sequenceæ¯ä¸€æ­¥ä¸äº§ç”Ÿæ–°é›†åˆ" class="headerlink" title="å››ã€sequenceæ¯ä¸€æ­¥ä¸äº§ç”Ÿæ–°é›†åˆ"></a>å››ã€sequenceæ¯ä¸€æ­¥ä¸äº§ç”Ÿæ–°é›†åˆ</h5><p>æ ‡å‡†çš„é›†åˆå¤„ç†å‡½æ•°æ¯ä¸€æ­¥éƒ½è¿”å›æ–°çš„é›†åˆï¼Œå½“æˆ‘ä»¬å¤„ç†å¤§é‡æ•°æ®æ—¶ä¼šåˆ†é…å¾ˆå¤šä¸´æ—¶å†…å­˜ã€‚</p>
<table>
     <tr>
         <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">num</span><br><span class="line">   .filter &#123;<span class="comment">// 1                   </span></span><br><span class="line">       it % <span class="number">10</span> == <span class="number">0</span> </span><br><span class="line">   &#125; </span><br><span class="line">   .map &#123;<span class="comment">// 2      </span></span><br><span class="line">       it * <span class="number">2</span> </span><br><span class="line">   &#125; </span><br><span class="line">   .sum()</span><br><span class="line"><span class="comment">// In total, 2 collections </span></span><br><span class="line"><span class="comment">// created under the hood</span></span><br></pre></td></tr></table></figure>
         </td>
         <td>
            <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num.asSequence()</span><br><span class="line">   .filter &#123;<span class="comment">//0 </span></span><br><span class="line">      it % <span class="number">10</span> == <span class="number">0</span> </span><br><span class="line">   &#125;</span><br><span class="line">   .map &#123;<span class="comment">//0</span></span><br><span class="line">      it * <span class="number">2</span> </span><br><span class="line">   &#125;</span><br><span class="line">   .sum()</span><br><span class="line"><span class="comment">// No collections created</span></span><br></pre></td></tr></table></figure>
         </td>
     </tr>
</table>

<p>ä¸€ä¸ªæç«¯åˆå¸¸è§çš„ä¾‹å­ï¼šæ–‡ä»¶è¯»å–ã€‚æ–‡ä»¶å¯èƒ½æ˜¯å‡ ä¸ªGï¼Œæ¯æ‰§è¡Œä¸€ä¸ªæ“ä½œç¬¦éƒ½åˆ†é…è¿™ä¹ˆå¤šå†…å­˜æ˜¯ä¸€ç§æå¤§çš„æµªè´¹ã€‚ä¸‹é¢ä¾‹å­æ˜¯è¯»å–å¤§å°1.53Gçš„èŠåŠ å“¥çŠ¯ç½ªè®°å½•ä¸­åŒ…å«æ¯’å“äº¤æ˜“ä¿¡æ¯çš„è®°å½•æ•°é‡ï¼Œå…¶ä¸­readLines è¿”å› List<String>ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BAD SOLUTION, DO NOT USE COLLECTIONS FOR </span></span><br><span class="line"><span class="comment">// POSSIBLY BIG FILES</span></span><br><span class="line">File(<span class="string">&quot;ChicagoCrimes.csv&quot;</span>)</span><br><span class="line">    .readLines()</span><br><span class="line">    .drop(<span class="number">1</span>) <span class="comment">// Drop descriptions of the columns</span></span><br><span class="line">    .mapNotNull &#123; it.split(<span class="string">&quot;,&quot;</span>).getOrNull(<span class="number">6</span>) &#125;</span><br><span class="line">    <span class="comment">// Find description</span></span><br><span class="line">    .filter &#123; <span class="string">&quot;CANNABIS&quot;</span> <span class="keyword">in</span> it &#125;</span><br><span class="line">    .count()</span><br><span class="line">    .let(::println)</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µç¨‹åºåœ¨æˆ‘ç”µè„‘ä¸Šçš„è¿è¡Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OutOfMemoryError.n&gt; Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé›†åˆï¼Œä¸­é—´ä¸‰ä¸ªæ“ä½œç¬¦äº§ç”Ÿé›†åˆï¼Œä¸€ä¸ªå››ä¸ªé›†åˆã€‚å…¶ä¸­ä¸‰ä¸ªåŒ…å«æ–‡ä»¶çš„ä¸»è¦ä¸»è¦æ•°æ®è®°å½•ï¼Œä¸€å…±æ¶ˆè€—4.59Gã€‚æ­£ç¡®çš„å®ç°åº”è¯¥ä½¿ç”¨sequenceï¼Œæˆ‘ä»¬ä½¿ç”¨<code>useLines</code>å‡½æ•°ï¼Œæ¯æ¬¡åªæ“ä½œä¸€è¡Œè®°å½•ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File(<span class="string">&quot;ChicagoCrimes.csv&quot;</span>).useLines &#123; lines -&gt;</span><br><span class="line"><span class="comment">// The type of `lines` is Sequence&lt;String&gt;</span></span><br><span class="line">    lines.drop(<span class="number">1</span>) <span class="comment">// Drop descriptions of the columns</span></span><br><span class="line">        .mapNotNull &#123; it.split(<span class="string">&quot;,&quot;</span>).getOrNull(<span class="number">6</span>) &#125;</span><br><span class="line">        <span class="comment">// Find description</span></span><br><span class="line">        .filter &#123; <span class="string">&quot;CANNABIS&quot;</span> <span class="keyword">in</span> it &#125;</span><br><span class="line">        .count()</span><br><span class="line">        .let &#123; println(it) &#125; <span class="comment">// 318185</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·è¿è¡Œè¿™æ®µä»£ç ï¼Œåªè€—æ—¶8.3sã€‚ä¸ºäº†æ¯”è¾ƒä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ³•çš„æ•ˆç‡ï¼Œæˆ‘åšäº†å¦å¤–ä¸€ä¸ªå®éªŒï¼šåˆ é™¤æ•°æ®ä¸­ä¸å¿…è¦çš„åˆ—ä»¥å‡å°‘æ–‡ä»¶å¤§å°ï¼Œå¾—åˆ°<code>CrimeData.csv</code>åªæœ‰728MBï¼Œç„¶ååšç›¸åŒçš„æ“ä½œã€‚ä½¿ç”¨Collectionå¤„ç†å‡½æ•°ï¼Œè€—æ—¶13sï¼Œä½¿ç”¨sequenceå‡½æ•°ï¼Œè€—æ—¶4.5sã€‚æ­£å¦‚å®éªŒæ•°æ®ï¼Œä½¿ç”¨sequenceå¤„ç†å¤§æ–‡ä»¶ä¸ä»…èŠ‚çº¦å†…å­˜ï¼Œè€Œä¸”æå‡æ€§èƒ½ã€‚</p>
<p>äº‹å®ä¸Šï¼Œåœ¨æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆæœ¬èº«ä¹Ÿæ˜¯ä¸€ç§æˆæœ¬ï¼Œå½“æˆ‘ä»¬å¤„ç†åŒ…å«å¤§é‡å…ƒç´ çš„é›†åˆæ—¶ï¼Œè¿™ç§æˆæœ¬å°±ä¼šæ˜¾ç°å‡ºæ¥ã€‚å·®åˆ«å¹¶ä¸å¤§â€”â€”ä¸»è¦æ˜¯å› ä¸ºåœ¨è®¸å¤šæ­¥éª¤ä¸­åˆ›å»ºçš„é›†åˆéƒ½æ˜¯ç”¨é¢„æœŸçš„å¤§å°åˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ·»åŠ å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒä»¬æ”¾åœ¨ä¸‹ä¸€ä¸ªä½ç½®ã€‚å°½ç®¡å³ä½¿æ˜¯å»‰ä»·çš„é›†åˆå¤åˆ¶ä¹Ÿæ¯”å®Œå…¨ä¸å¤åˆ¶è¦æ˜‚è´µï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥æ›´å–œæ¬¢å¯¹å…·æœ‰<em>å¤šä¸ªå¤„ç†æ­¥éª¤</em>çš„<em>å¤§é›†åˆ</em>ä½¿ç”¨Sequenceçš„ä¸»è¦åŸå› ã€‚</p>
<blockquote>
<p>å¤§é›†åˆï¼šå…ƒç´ å¤šï¼ˆå«æ•°ä¸‡ä¸ªå…ƒç´ çš„æ•´æ•°åˆ—è¡¨ï¼‰ã€å…ƒç´ å¤§ï¼ˆè¶…é•¿å­—ç¬¦ä¸²ï¼‰</p>
<p>å¤šä¸ªå¤„ç†æ­¥éª¤ï¼šå¤„ç†é›†åˆæ—¶ä½¿ç”¨å¾ˆå¤šæ“ä½œç¬¦ã€‚</p>
</blockquote>
<p>å¦‚æœå¯¹æ¯”ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">singleStepListProcessing</span><span class="params">()</span></span>: List&lt;Product&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList.filter &#123; it.bought &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">singleStepSequenceProcessing</span><span class="params">()</span></span>: List&lt;Product&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList.asSequence()</span><br><span class="line">        .filter &#123; it.bought &#125;</span><br><span class="line">        .toList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç°ï¼Œåœ¨æ€§èƒ½ä¸ŠåŒºåˆ«ä¸å¤§ï¼ˆå®é™…ä¸Šï¼Œç®€å•çš„listå¤„ç†æ›´å¿«ï¼Œå› ä¸ºå®ƒçš„filterå‡½æ•°æ˜¯å†…è”çš„ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“ä½ ä½¿ç”¨å¤šä¸ªæ“ä½œç¬¦ï¼Œå…ˆfilterå†mapï¼Œåœ¨å¤§é›†åˆä¸Šæ€§èƒ½é—®é¢˜å°±è¡Œæ˜¾ç°å‡ºæ¥ã€‚ä¸ºäº†çœ‹åˆ°åŒºåˆ«ï¼Œæˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹2ä¸ªæ“ä½œç¬¦å’Œ3ä¸ªæ“ä½œç¬¦å¤„ç†5000ä¸ªæ•°æ®çš„æƒ…å†µï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">twoStepListProcessing</span><span class="params">()</span></span>: List&lt;<span class="built_in">Double</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList</span><br><span class="line">        .filter &#123; it.bought &#125;</span><br><span class="line">        .map &#123; it.price &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">twoStepSequenceProcessing</span><span class="params">()</span></span>: List&lt;<span class="built_in">Double</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList.asSequence()</span><br><span class="line">        .filter &#123; it.bought &#125;</span><br><span class="line">        .map &#123; it.price &#125;</span><br><span class="line">        .toList()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">threeStepListProcessing</span><span class="params">()</span></span>: <span class="built_in">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList</span><br><span class="line">        .filter &#123; it.bought &#125;</span><br><span class="line">        .map &#123; it.price &#125;</span><br><span class="line">        .average()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">threeStepSequenceProcessing</span><span class="params">()</span></span>: <span class="built_in">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productsList.asSequence()</span><br><span class="line">        .filter &#123; it.bought &#125;</span><br><span class="line">        .map &#123; it.price &#125;</span><br><span class="line">        .average()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯åœ¨MacBook Pro(Retina, 15-inch, Late 2013)å¤„ç†5000ä¸ªå…ƒç´ çš„å¹³å‡ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">twoStepListProcessing                        81 095 ns</span><br><span class="line">twoStepSequenceProcessing                    55 685 ns</span><br><span class="line">twoStepListProcessingAndAcumulate            83 307 ns</span><br><span class="line">twoStepSequenceProcessingAndAcumulate         6 928 ns</span><br></pre></td></tr></table></figure>

<p>å¾ˆéš¾é¢„æµ‹æˆ‘ä»¬èƒ½æå‡ä½†æ˜¯æ€§èƒ½ï¼Œæ ¹æ®æˆ‘çš„è§‚å¯Ÿï¼Œåœ¨ä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„å…¸å‹é›†åˆå¤„ç†ä¸­ï¼Œå¯¹äºè‡³å°‘å‡ åƒä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸå¤§çº¦20-40%çš„æ€§èƒ½æå‡ã€‚</p>
<h5 id="äº”ã€sequenceä»€ä¹ˆæ—¶å€™æ²¡é‚£ä¹ˆå¿«ï¼Ÿ"><a href="#äº”ã€sequenceä»€ä¹ˆæ—¶å€™æ²¡é‚£ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="äº”ã€sequenceä»€ä¹ˆæ—¶å€™æ²¡é‚£ä¹ˆå¿«ï¼Ÿ"></a>äº”ã€sequenceä»€ä¹ˆæ—¶å€™æ²¡é‚£ä¹ˆå¿«ï¼Ÿ</h5><p>æœ‰äº›æƒ…å†µæˆ‘ä»¬è¦å¤„ç†æ•´ä¸ªé›†åˆï¼Œsequenceå¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆæ”¶ç›Šã€‚å¦‚<code>sorted</code>ï¼ˆå½“å‰æ¥è®²å®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªä¾‹å­ï¼‰ã€‚sortedçš„æœ€ä¼˜å®ç°ï¼šç§¯æ”’Sequenceå¹¶æ”¾å…¥Listï¼Œç„¶åä½¿ç”¨Javaçš„sortå‡½æ•°ã€‚ç¼ºç‚¹æ˜¯ï¼Œä¸<code>Collection.sort</code>ç›¸æ¯”ï¼Œç§¯æ”’è¿‡ç¨‹ä¼šæ¶ˆè€—é¢å¤–çš„æ—¶é—´ã€‚</p>
<p>Sequenceæ˜¯å¦åº”è¯¥æ”¯æŒ<code>sorted</code>å‡½æ•°æ˜¯æœ‰äº‰è®®çš„ï¼Œå› ä¸ºå½“ä¸€ä¸ªåºåˆ—çš„æ–¹æ³•éœ€è¦æ‰€æœ‰å…ƒç´ æ‰èƒ½å®Œæˆè®¡ç®—æ—¶ï¼Œåç»­æ“ä½œåªæ˜¯éƒ¨åˆ†å»¶è¿Ÿï¼Œå¹¶ä¸”å®ƒä¸æ”¯æŒæ— é™åºåˆ—ã€‚ä¹‹æ‰€ä»¥æ·»åŠ sortedæ“ä½œåªæ˜¯å› ä¸ºå®ƒå¾ˆå¸¸ç”¨ï¼Œå¥½ç”¨ã€‚Kotlinå¼€å‘è€…éœ€è¦äº†è§£å®ƒçš„ç¼ºé™·ï¼Œå°¤å…¶æ˜¯å®ƒä¸èƒ½ç”¨äºæ— é™åºåˆ—ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">generateSequence(<span class="number">0</span>) &#123; it + <span class="number">1</span> &#125;.take(<span class="number">10</span>).sorted().toList()</span><br><span class="line"><span class="comment">// [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line">generateSequence(<span class="number">0</span>) &#123; it + <span class="number">1</span> &#125;.sorted().take(<span class="number">10</span>).toList()</span><br><span class="line"><span class="comment">// Infinite time. Does not return.</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Collectionä¸Šä½¿ç”¨sortedæ¯”åœ¨Sequenceä¸Šæ›´å¿«åªæ˜¯å°‘æ•°ç‰¹ä¾‹ã€‚å½“æˆ‘ä»¬åªä½¿ç”¨å¾ˆå°‘æ“ä½œç¬¦å‡½æ•°å’Œå•ä¸ªsortedå‡½æ•°æ—¶ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨sequenceæ¥å¤„ç†ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">productsList.asSequence()</span><br><span class="line">    .filter &#123; it.bought &#125;</span><br><span class="line">    .map &#123; it.price &#125;</span><br><span class="line">    .sorted()</span><br><span class="line">    .take(<span class="number">10</span>)</span><br><span class="line">    .sum()</span><br></pre></td></tr></table></figure>

<h5 id="å…­ã€çœ‹çœ‹Javaçš„Streamæ“ä½œ"><a href="#å…­ã€çœ‹çœ‹Javaçš„Streamæ“ä½œ" class="headerlink" title="å…­ã€çœ‹çœ‹Javaçš„Streamæ“ä½œ"></a>å…­ã€çœ‹çœ‹Javaçš„Streamæ“ä½œ</h5><p>Java 8æ–°å¢äº†é›†åˆå¤„ç†æµçš„ç‰¹æ€§ï¼Œçœ‹èµ·æ¥å’ŒKotlinçš„åºåˆ—å¾ˆåƒã€‚</p>
<table>
     <tr>
         <td>
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">productsList.asSequence()</span><br><span class="line">    .filter &#123; it.bought &#125;</span><br><span class="line">    .map &#123; it.price &#125;</span><br><span class="line">    .average()</span><br></pre></td></tr></table></figure>
         </td>
         <td>
            <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">productsList.stream()</span><br><span class="line">    .filter &#123; it.bought &#125;</span><br><span class="line">    .mapToDouble &#123; it.price &#125;</span><br><span class="line">    .average()</span><br><span class="line">    .orElse(<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure>
         </td>
     </tr>
</table>

<p>Java 8çš„Streamä¹Ÿæ˜¯æƒ°æ€§çš„åœ¨æœ€åä¸€ä¸ªæ“ä½œç¬¦è§¦å‘è®¡ç®—ã€‚ä¸Kotlin sequenceçš„åŒºåˆ«ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>Kotlin sequenceåŒ…å«æ›´å¤šçš„å¤„ç†å‡½æ•°ï¼ˆè¢«å®šä¹‰ä¸ºæ‹“å±•å‡½æ•°ï¼‰ï¼Œä½¿ç”¨ç®€å•: <code>toList()</code> vs <code>collect(Collectors.toList())</code></li>
<li>Java streamå¯ä»¥å¼€å¯å¹¶è¡Œæ¨¡å¼ï¼Œåœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šä¼šæœ‰å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚</li>
<li>Kotlin sequenceå¯ä»¥ç”¨äºKotlin/JVMã€Kotlin/JSã€Kotlin/Nativeæ¨¡å—ä¸­ã€‚Java streamåªèƒ½ç”¨äºKotlin/JVMï¼Œä¸”JVMç‰ˆæœ¬è‡³å°‘æ˜¯8</li>
</ul>
<p>æ€»ä¹‹ï¼Œæˆ‘ä»¬ä¸ç”¨Java streamå¹¶è¡Œæ¨¡å¼æ—¶å¾ˆéš¾å°†è°çš„æ€§èƒ½æ›´å¥½ï¼Œæˆ‘å»ºè®®å°‘ç”¨Java streamï¼Œåªæœ‰åœ¨å¤„ç†é‡é‡çº§è®¡ç®—é—®é¢˜ä¸­ä½¿ç”¨å¹¶è¡Œæ¨¡å¼å¯ä»¥æ˜¾è‘—å¸¦æ¥æ”¶ç›Šçš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå…¶ä»–æƒ…å†µç”¨Kotlinæ ‡å‡†å‡½æ•°èƒ½å¸¦æ¥æ¸…æ™°çš„ä»£ç ç»“æ„å’Œå¤šå¹³å°æ”¯æŒã€‚</p>
<h5 id="ä¸ƒã€è°ƒè¯•Sequence"><a href="#ä¸ƒã€è°ƒè¯•Sequence" class="headerlink" title="ä¸ƒã€è°ƒè¯•Sequence"></a>ä¸ƒã€è°ƒè¯•Sequence</h5><p>Kotlin Sequenceå’ŒJava Streaméƒ½æ”¯æŒdebugæ¯ä¸€æ­¥æ“ä½œã€‚Javaéœ€è¦ä½¿ç”¨â€Java Stream Debuggerâ€æ’ä»¶ï¼ŒKotlinåˆ™éœ€è¦â€Kotlin Sequence Debuggerâ€æ’ä»¶ï¼Œç°åœ¨å·²ç»è¢«é›†æˆåœ¨äº†Kotlinæ’ä»¶ä¸­äº†ã€‚</p>
<center>
    <img src="../images/kotlin_sequence_debug.jpeg" width="500"/>
</center>


<h4 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h4><p>é›†åˆå’Œåºåˆ—éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ”¯æŒç›¸åŒçš„å¤„ç†å‡½æ•°ã€‚ä½†ä»–ä»¬ä¹Ÿæœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚Sequenceå¤„ç†æ˜¯å›°éš¾çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¿æŒåŸé›†åˆä¸å˜ï¼Œæ‰§è¡Œç›¸åº”è½¬æ¢åå†æ”¾å›åŸé›†åˆã€‚Sequenceæ˜¯æƒ°æ€§çš„ï¼Œå¸¦æ¥å¾ˆå¤šä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¿è¯æ“ä½œçš„é¡ºåºæ€§</li>
<li>ä¿è¯æ“ä½œæ‰§è¡Œæ¬¡æ•°æœ€å°‘åŒ–</li>
<li>ä»–ä»¬å¯ä»¥æ˜¯æ— é™çš„</li>
<li>æ— éœ€æ¯ä¸€æ­¥åˆ›å»ºæ–°çš„é›†åˆ</li>
</ul>
<p>åŸºäºè¿™äº›ä¼˜ç‚¹ï¼Œå¯¹äºåŒ…å«å¤šä¸ªå¤„ç†æ­¥éª¤çš„åŒ…å«å¤§å¯¹è±¡æˆ–å…ƒç´ å¾ˆå¤šçš„é›†åˆæ¥è¯´ä½¿ç”¨Sequenceæ›´å¥½ã€‚Sequenceä¹ŸåŒ…å«è°ƒè¯•å™¨ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å¯è§†åŒ–çš„åˆ†æå…ƒç´ å¤„ç†è¿‡ç¨‹ã€‚Sequenceä¸æ˜¯ä¸ºäº†å–ä»£ä¼ ç»Ÿçš„é›†åˆå¤„ç†æ–¹å¼ï¼Œä½¿ç”¨å‰åº”è¯¥åˆ†ææ¸…æ¥šè‡ªå·±çš„ç›®çš„å’ŒåŸå› æ‰èƒ½å¸¦æ¥æ€§èƒ½çš„æå‡ä»¥åŠæ›´å°‘çš„å†…å­˜é—®é¢˜ã€‚</p>
<h4 id="å››ã€å‚è€ƒ"><a href="#å››ã€å‚è€ƒ" class="headerlink" title="å››ã€å‚è€ƒ"></a>å››ã€å‚è€ƒ</h4><p><a target="_blank" rel="noopener" href="https://kt.academy/article/ek-sequence">Effective Kotlin Item 51: Prefer Sequence for big collections with more than one processing step</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/kotlin-coroutine-deep-recursion.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kotlin-coroutine-deep-recursion.html" class="post-title-link" itemprop="url">ç”¨Kotlinåç¨‹è§£å†³æ·±åº¦é€’å½’é—®é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-30 10:38:30" itemprop="dateCreated datePublished" datetime="2021-10-30T10:38:30+08:00">2021-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>3 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>&ensp;&ensp;&ensp;&ensp;åç¨‹ä¸€èˆ¬ç”¨äºå¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨è§£å†³å¼‚æ­¥ç¼–ç¨‹é—®é¢˜æ–¹é¢ï¼ŒKotlinç¼–è¯‘å™¨åœ¨å¯¹åç¨‹çš„è®¾è®¡å’Œå®ç°æ˜¯é€šç”¨çš„ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©åç¨‹ä¼˜é›…çš„è§£å†³æ·±åº¦é€’å½’é—®é¢˜ã€‚</p>
<h4 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h4><p>å®šä¹‰ä»¥ä¸‹äºŒå‰æ ‘çš„ç»“ç‚¹ï¼Œå¹¶æ„é€ ä¸€æ£µåªå«åä¸‡ä¸ªå·¦ç»“ç‚¹çš„æ ‘ï¼Œè¿›è¡Œæ·±åº¦éå†ï¼Œæ±‚æ ‘çš„æ·±åº¦ï¼š  </p>
<center>
    <img src="../images/tree_only_left.png" width="500"/>
</center>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»“ç‚¹å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span></span>(<span class="keyword">val</span> left: Tree?, <span class="keyword">val</span> right: Tree?)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ äºŒå‰æ ‘ï¼šä»¥å¶å­ç»“ç‚¹å¼€å§‹ï¼Œé‡å¤æ„é€ çˆ¶ç»“ç‚¹ï¼Œå¹¶æŠŠå½“å‰ç»“ç‚¹ä½œä¸ºçˆ¶ç»“ç‚¹çš„å·¦å­æ ‘</span></span><br><span class="line"><span class="keyword">val</span> n = <span class="number">100_000</span></span><br><span class="line"><span class="keyword">val</span> deepTree = generateSequence(Tree(<span class="literal">null</span>, <span class="literal">null</span>)) &#123; prev -&gt;</span><br><span class="line">    Tree(prev, <span class="literal">null</span>) </span><br><span class="line">&#125;.take(n).last()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="äºŒã€è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€è§£å†³æ–¹æ¡ˆ"></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h4><h5 id="2-1-è§£å†³æ–¹æ¡ˆä¸€ï¼š"><a href="#2-1-è§£å†³æ–¹æ¡ˆä¸€ï¼š" class="headerlink" title="2.1 è§£å†³æ–¹æ¡ˆä¸€ï¼š"></a>2.1 è§£å†³æ–¹æ¡ˆä¸€ï¼š</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">depth</span><span class="params">(t: <span class="type">Tree</span>?)</span></span>: <span class="built_in">Int</span> =</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="literal">null</span>) <span class="number">0</span> <span class="keyword">else</span> maxOf(</span><br><span class="line">        depth(t.left), <span class="comment">// recursive call one</span></span><br><span class="line">        depth(t.right) <span class="comment">// recursive call two</span></span><br><span class="line">    ) + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š<br>å¯¹æ ‘è¿›è¡Œé€’å½’æ˜¯æœ€ç®€æ´ç›´æ¥çš„è§£å†³æ–¹æ¡ˆã€‚è€Œé€’å½’å°†ä¿å­˜å‡½æ•°çš„è°ƒç”¨æ ˆç”¨äºåç»­çŠ¶æ€æ¢å¤ï¼Œçº¿ç¨‹çš„è°ƒç”¨æ ˆæ˜¯æœ‰å¤§å°é™åˆ¶çš„ï¼Œæ­¤å¤„å°†æŠ›å‡º<code>Exception in thread &quot;main&quot; java.lang.StackOverflowError</code>é”™è¯¯ã€‚</p>
<h5 id="2-2-è§£å†³æ–¹æ¡ˆäºŒï¼š"><a href="#2-2-è§£å†³æ–¹æ¡ˆäºŒï¼š" class="headerlink" title="2.2 è§£å†³æ–¹æ¡ˆäºŒï¼š"></a>2.2 è§£å†³æ–¹æ¡ˆäºŒï¼š</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">depth</span><span class="params">(t: <span class="type">Tree</span>?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (t == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">      <span class="class"><span class="keyword">class</span> <span class="title">Frame</span></span>(<span class="keyword">val</span> node: Tree, <span class="keyword">var</span> state: <span class="built_in">Int</span> = <span class="number">0</span>, <span class="keyword">var</span> depth: <span class="built_in">Int</span> = <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">val</span> stack = ArrayList&lt;Frame&gt;()</span><br><span class="line">      <span class="keyword">val</span> root = Frame(t)</span><br><span class="line">      stack.add(root)</span><br><span class="line">      <span class="keyword">while</span> (stack.isNotEmpty()) &#123;</span><br><span class="line">          <span class="keyword">val</span> frame = stack.last()</span><br><span class="line">          <span class="keyword">when</span> (frame.state++) &#123;</span><br><span class="line">              <span class="number">0</span> -&gt; frame.node.left?.let &#123; l -&gt; stack.add(Frame(l)) &#125;</span><br><span class="line">              <span class="number">1</span> -&gt; frame.node.right?.let &#123; r -&gt; stack.add(Frame(r)) &#125;</span><br><span class="line">              <span class="number">2</span> -&gt; &#123;</span><br><span class="line">                  stack.removeLast()</span><br><span class="line">                  stack.lastOrNull()?.let &#123; p -&gt; </span><br><span class="line">                      p.depth = maxOf(p.depth, frame.depth + <span class="number">1</span>) </span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> root.depth</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†æï¼š<br>åŸºäºè§£å†³æ–¹æ¡ˆä¸€ï¼Œæˆ‘ä»¬è€ƒè™‘å°†è°ƒç”¨æ ˆçŠ¶æ€çš„ä¿å­˜è½¬ç§»åˆ°å†…å­˜ç©ºé—´æ›´å¤§çš„å †åŒºï¼Œå¹¶åŠ å…¥äº†çŠ¶æ€æœºå’Œ<code>while</code>å¾ªç¯ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œç¨‹åºå¼€å§‹æ—¶å°†å…¨éƒ¨èµ°çŠ¶æ€0ï¼Œå°†æ‰€æœ‰çš„å·¦èŠ‚ç‚¹åŠ å…¥stackã€‚ç„¶åå…¨éƒ¨èµ°çŠ¶æ€2(å› ä¸ºæ²¡æœ‰å³ç»“ç‚¹)ï¼Œç”±ä¸‹åˆ°ä¸Šè®¡ç®—æ¯ä¸€ä¸ªç»“ç‚¹çš„æ·±åº¦ã€‚æœ€åè¿”å›æ ¹èŠ‚ç‚¹çš„æ·±åº¦ã€‚</p>
<h5 id="2-3-è§£å†³æ–¹æ¡ˆä¸‰ï¼š"><a href="#2-3-è§£å†³æ–¹æ¡ˆä¸‰ï¼š" class="headerlink" title="2.3 è§£å†³æ–¹æ¡ˆä¸‰ï¼š"></a>2.3 è§£å†³æ–¹æ¡ˆä¸‰ï¼š</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> depth = DeepRecursiveFunction&lt;Tree?, <span class="built_in">Int</span>&gt; &#123; t -&gt;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="literal">null</span>) <span class="number">0</span> <span class="keyword">else</span> maxOf(</span><br><span class="line">            callRecursive(t.left),</span><br><span class="line">            callRecursive(t.right)</span><br><span class="line">        ) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†æï¼š<br>æ–¹æ¡ˆäºŒä¸­çš„çŠ¶æ€æœºå°±æ˜¯KotlinæŒ‚èµ·å‡½æ•°çš„å®ç°åŸç†ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨Kotlinçš„æŒ‚èµ·å‡½æ•°å®ç°æ·±åº¦éå†ã€‚é‚£ä¹ˆæ–¹æ¡ˆä¸‰æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬åˆ†æä¸‰ä¸ªæ–¹é¢ï¼š  </p>
<ul>
<li>å¦‚ä½•è°ƒç”¨</li>
<li>å¦‚ä½•è¿›å…¥å¾ªç¯</li>
<li>å¦‚ä½•ä¿å­˜çŠ¶æ€</li>
</ul>
<p>2.3.1 è°ƒç”¨<br><code>DeepRecursiveFunction</code>ç±»å£°æ˜äº†<code>invoke</code>æ“ä½œç¬¦ï¼Œè°ƒç”¨<code>depth</code>å‡½æ•°å°±æ˜¯è°ƒç”¨ä¸‹é¢ğŸ‘‡ğŸ»çš„æ“ä½œç¬¦ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SinceKotlin(<span class="meta-string">&quot;1.4&quot;</span>)</span></span><br><span class="line"><span class="meta">@ExperimentalStdlibApi</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> DeepRecursiveFunction<span class="type">&lt;T, R&gt;</span>.<span class="title">invoke</span><span class="params">(value: <span class="type">T</span>)</span></span>: R =</span><br><span class="line">    DeepRecursiveScopeImpl&lt;T, R&gt;(block, value).runCallLoop()</span><br></pre></td></tr></table></figure>

<p>2.3.2 å¾ªç¯<br>è°ƒç”¨<code>DeepRecursiveFunction</code>åç›´æ¥è¿›å…¥<code>runCallLoop()</code>å¾ªç¯ï¼Œresultçš„é»˜è®¤å€¼ä¸ºUNDEFINED_RESULTï¼Œæ‰€ä»¥ä¼šå¯åŠ¨æˆ‘ä»¬çš„é€’å½’ä¸šåŠ¡é€»è¾‘</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="meta-string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">runCallLoop</span><span class="params">()</span></span>: R &#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">           <span class="comment">// Note: cont is set to null in DeepRecursiveScopeImpl.resumeWith when the whole computation completes</span></span><br><span class="line">           <span class="keyword">val</span> result = <span class="keyword">this</span>.result</span><br><span class="line">           <span class="keyword">val</span> cont = <span class="keyword">this</span>.cont</span><br><span class="line">               ?: <span class="keyword">return</span> (result <span class="keyword">as</span> Result&lt;R&gt;).getOrThrow() <span class="comment">// done -- final result</span></span><br><span class="line">           <span class="comment">// The order of comparison is important here for that case of rogue class with broken equals</span></span><br><span class="line">           <span class="keyword">if</span> (UNDEFINED_RESULT == result) &#123;</span><br><span class="line">               <span class="comment">// call &quot;function&quot; with &quot;value&quot; using &quot;cont&quot; as completion</span></span><br><span class="line">               <span class="keyword">val</span> r = <span class="keyword">try</span> &#123;</span><br><span class="line">                   <span class="comment">// This is block.startCoroutine(this, value, cont)</span></span><br><span class="line">                   function.startCoroutineUninterceptedOrReturn(<span class="keyword">this</span>, value, cont)</span><br><span class="line">               &#125; <span class="keyword">catch</span> (e: Throwable) &#123;</span><br><span class="line">                   cont.resumeWithException(e)</span><br><span class="line">                   <span class="keyword">continue</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">// If the function returns without suspension -- calls its continuation immediately</span></span><br><span class="line">               <span class="keyword">if</span> (r !== COROUTINE_SUSPENDED)</span><br><span class="line">                   cont.resume(r <span class="keyword">as</span> R)</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// we returned from a crossFunctionCompletion trampoline -- call resume here</span></span><br><span class="line">               <span class="keyword">this</span>.result = UNDEFINED_RESULT <span class="comment">// reset result back</span></span><br><span class="line">               cont.resumeWith(result)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<p>2.3.3 çŠ¶æ€ä¿å­˜<br>æ¯æ¬¡è°ƒç”¨<code>callRecursive</code>æ—¶å°†ä¿å­˜å½“å‰çš„å€¼å’Œcontï¼ˆcontinuationï¼‰ï¼Œæ³¨æ„è¿™é‡Œcontå¯¹è±¡æ¯æ¬¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å½“è¿›è¡ŒæŒ‚èµ·æ¢å¤æ—¶ï¼Œæ‹¿åˆ°æ—§çš„continuationè¿›è¡Œå›è°ƒã€‚</p>
<center>
    <img src="../images/kotlin_coroutine_resume.jpeg" width="500"/>
</center>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">callRecursive</span><span class="params">(value: <span class="type">T</span>)</span></span>: R = </span><br><span class="line">    suspendCoroutineUninterceptedOrReturn &#123; cont -&gt;</span><br><span class="line">        <span class="keyword">this</span>.cont = cont</span><br><span class="line">        <span class="keyword">this</span>.value = value</span><br><span class="line">        COROUTINE_SUSPENDED</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h4 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h4><p><a target="_blank" rel="noopener" href="https://elizarov.medium.com/deep-recursion-with-coroutines-7c53e15993e3">Deep recursion with coroutines</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/android-basic-constraintlayout.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android-basic-constraintlayout.html" class="post-title-link" itemprop="url">Androidä¸­çš„çº¦æŸå¸ƒå±€</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-23 15:03:23" itemprop="dateCreated datePublished" datetime="2021-10-23T15:03:23+08:00">2021-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>5 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>&ensp;&ensp;&ensp;&ensp;Androidä¸­çš„è§†å›¾æ˜¯ä»¥æ ‘çš„å½¢å¼ç»„ç»‡èµ·æ¥çš„ï¼Œå®ƒæ˜¯ä¸€ç§å±‚æ¬¡ç»“æ„ã€‚åœ¨ä»£ç ä¸­ä½“ç°ä¸ºç»„åˆæ¨¡å¼ï¼Œä¸€ä¸ªViewGroupå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªViewï¼ŒåŒæ—¶ViewGroupåˆæ˜¯ä¸€ä¸ªViewã€‚åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½“ç°ä¸ºxmlçš„ç»“ç‚¹å’Œç¼©è¿›ã€‚<br>&ensp;&ensp;&ensp;&ensp;åŒæ—¶è§†å›¾çš„æ¸²æŸ“å°‘ä¸äº†å¯¹å…¶è¿›è¡Œéå†ï¼Œè¿™å°±æ¶‰åŠæ•°æ®ç»“æ„ä¸­æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†å’Œå¹¿åº¦ä¼˜å…ˆéå†ã€‚æœ‰æ—¶å€™ä¸€äº›å¤æ‚çš„å¸ƒå±€ä¸€æ¬¡éå†è¿˜æ— æ³•å®Œå…¨ç¡®å®šViewçš„ä¿¡æ¯ã€‚å¦‚ä½•é€šè¿‡ç®—æ³•æ–¹å¼é™ä½æ ‘çš„å±‚æ¬¡å‘¢ï¼Ÿä¹Ÿè®¸è¿™å°±æ˜¯çº¦æŸå¸ƒå±€å­˜åœ¨çš„æ„ä¹‰å§ã€‚<br>&ensp;&ensp;&ensp;&ensp;åœ¨Androidä¸­ï¼Œçµæ´»è¿ç”¨ConstraintLayoutåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li>ä¸»å±æ€§<ul>
<li>é€šè¿‡ç›¸å¯¹ä½ç½®çº¦æŸView</li>
<li>æ§åˆ¶çº¦æŸä¹‹é—´çš„è·ç¦»</li>
<li>å±…ä¸­å’Œåç§»ç™¾åˆ†æ¯”</li>
<li>é€šè¿‡åœ†å®šä½ğŸ“ŒView</li>
<li>é€šè¿‡å¯è§æ€§æ§åˆ¶View</li>
<li>é€šè¿‡åˆ†è¾¨ç‡çº¦æŸView</li>
<li>é€šè¿‡é“¾â›“çº¦æŸView</li>
</ul>
</li>
<li>è¾…åŠ©å·¥å…·<ul>
<li>Barrierå±éšœçº¦æŸ</li>
<li>Groupåˆ†ç»„çº¦æŸ</li>
<li>Placeholderå ä½çº¦æŸ</li>
<li>Guidelineå¼•å¯¼çº¿çº¦æŸ</li>
</ul>
</li>
</ul>
<h4 id="äºŒã€ä½¿ç”¨"><a href="#äºŒã€ä½¿ç”¨" class="headerlink" title="äºŒã€ä½¿ç”¨"></a>äºŒã€ä½¿ç”¨</h4><h5 id="2-1-é€šè¿‡ç›¸å¯¹ä½ç½®çº¦æŸView"><a href="#2-1-é€šè¿‡ç›¸å¯¹ä½ç½®çº¦æŸView" class="headerlink" title="2.1 é€šè¿‡ç›¸å¯¹ä½ç½®çº¦æŸView"></a>2.1 é€šè¿‡ç›¸å¯¹ä½ç½®çº¦æŸView</h5><center>
    <img src="../images/constraint/constraint_relative_position.png" width="500"/>
</center>

<table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>layout_constraintLeft_toLeftOf</td>
<td></td>
<td>layout_constraintLeft_toRightOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintRight_toLeftOf</td>
<td></td>
<td>layout_constraintRight_toRightOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintTop_toTopOf</td>
<td></td>
<td>layout_constraintTop_toBottomOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintBottom_toTopOf</td>
<td></td>
<td>layout_constraintBottom_toBottomOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintStart_toEndOf</td>
<td></td>
<td>layout_constraintStart_toStartOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintEnd_toStartOf</td>
<td></td>
<td>layout_constraintEnd_toEndOf</td>
<td></td>
</tr>
<tr>
<td>layout_constraintBaseline_toBaselineOf</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="2-2-æ§åˆ¶çº¦æŸä¹‹é—´çš„è·ç¦»"><a href="#2-2-æ§åˆ¶çº¦æŸä¹‹é—´çš„è·ç¦»" class="headerlink" title="2.2 æ§åˆ¶çº¦æŸä¹‹é—´çš„è·ç¦»"></a>2.2 æ§åˆ¶çº¦æŸä¹‹é—´çš„è·ç¦»</h5><center>
    <img src="../images/constraint/constraint_margin.png" width="500"/>
</center> 

<table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>android:layout_marginStart</td>
<td></td>
<td>layout_goneMarginStart</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginEnd</td>
<td></td>
<td>layout_goneMarginEnd</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginLeft</td>
<td></td>
<td>layout_goneMarginLeft</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginTop</td>
<td></td>
<td>layout_goneMarginTop</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginRight</td>
<td></td>
<td>layout_goneMarginRight</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginBottom</td>
<td></td>
<td>layout_goneMarginBottom</td>
<td></td>
</tr>
<tr>
<td>android:layout_marginBaseline</td>
<td></td>
<td>layout_goneMarginBaseline</td>
<td></td>
</tr>
</tbody></table>
<h5 id="2-3-å±…ä¸­å’Œåç§»ç™¾åˆ†æ¯”"><a href="#2-3-å±…ä¸­å’Œåç§»ç™¾åˆ†æ¯”" class="headerlink" title="2.3 å±…ä¸­å’Œåç§»ç™¾åˆ†æ¯”"></a>2.3 å±…ä¸­å’Œåç§»ç™¾åˆ†æ¯”</h5><table>
    <tr>
        <td><img src="../images/constraint/constraint_center_position.png" width="300"/></td>
        <td><img src="../images/constraint/constraint_center_position_bias.png" width="300"/></td>
    </tr>
</table>

<table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>layout_constraintHorizontal_bias</td>
<td></td>
<td>layout_constraintVertical_bias</td>
<td></td>
</tr>
</tbody></table>
<h5 id="2-4-é€šè¿‡åœ†å®šä½ğŸ“ŒView"><a href="#2-4-é€šè¿‡åœ†å®šä½ğŸ“ŒView" class="headerlink" title="2.4 é€šè¿‡åœ†å®šä½ğŸ“ŒView"></a>2.4 é€šè¿‡åœ†å®šä½ğŸ“ŒView</h5><center>
    <img src="../images/constraint/constraint_circular_position.jpeg" width="400"/>
</center>

<table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>layout_constraintCircle</td>
<td>å¦ä¸€ä¸ªwidgetçš„id</td>
</tr>
<tr>
<td>layout_constraintCircleRadius</td>
<td>åœ†çš„åŠå¾„</td>
</tr>
<tr>
<td>layout_constraintCircleAngle</td>
<td>è§’åº¦</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonB&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintCircle</span>=<span class="string">&quot;@+id/buttonA&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintCircleRadius</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_constraintCircleAngle</span>=<span class="string">&quot;45&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-5-é€šè¿‡å¯è§æ€§æ§åˆ¶View"><a href="#2-5-é€šè¿‡å¯è§æ€§æ§åˆ¶View" class="headerlink" title="2.5 é€šè¿‡å¯è§æ€§æ§åˆ¶View"></a>2.5 é€šè¿‡å¯è§æ€§æ§åˆ¶View</h5><center>
    <img src="../images/constraint/constraint_visibility_behavior.jpeg" width="400"/>
</center>

<h5 id="2-6-é€šè¿‡åˆ†è¾¨ç‡çº¦æŸView"><a href="#2-6-é€šè¿‡åˆ†è¾¨ç‡çº¦æŸView" class="headerlink" title="2.6 é€šè¿‡åˆ†è¾¨ç‡çº¦æŸView"></a>2.6 é€šè¿‡åˆ†è¾¨ç‡çº¦æŸView</h5><table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>android:minWidth</td>
<td></td>
<td>android:minHeight</td>
<td></td>
</tr>
<tr>
<td>android:maxWidth</td>
<td></td>
<td>android:maxHeight</td>
<td></td>
</tr>
</tbody></table>
<p>2.6.1 ç™¾åˆ†æ¯”</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonA&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintWidth_default</span>=<span class="string">&quot;percent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintWidth_percent</span>=<span class="string">&quot;0.5&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>app:layout_constraintWidth_default</code>å¯ä»¥å–çš„å€¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>spread</li>
<li>percent</li>
<li>wrap</li>
</ul>
<p>åœ¨ConstraintLayout-1.1ä¹‹åï¼Œä½¿ç”¨<code>app:layout_constrainedWidth=&quot;true&quot;</code>æ›¿ä»£<code>app:layout_constraintWidth_default=&quot;wrap&quot;</code></p>
<p>2.6.2 æ¯”ç‡<br>å®½é«˜ä¸€æ¯”ä¸€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonA&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">&quot;1:1&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šä¸€æ¡è¾¹ç¬¦åˆçº¦æŸæ¯”ç‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintDimensionRatio</span>=<span class="string">&quot;H,16:9&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-7-é€šè¿‡é“¾â›“çº¦æŸView"><a href="#2-7-é€šè¿‡é“¾â›“çº¦æŸView" class="headerlink" title="2.7 é€šè¿‡é“¾â›“çº¦æŸView"></a>2.7 é€šè¿‡é“¾â›“çº¦æŸView</h5><table>
    <tr>
        <td><img src="../images/constraint/constraint_chain.png" width="300"/></td>
        <td><img src="../images/constraint/constraint_chain_head.png" width="300"/></td>
    </tr>
</table>

<table>
    <tr>
        <td>å›¾ç¤º</td>
        <td>Style</td>
    </tr>
    <tr>
        <td><img src="../images/constraint/constraint_chain_spread.png" width="250"/></td>
        <td> _chainStyle="spread" </td>
    </tr>
     <tr>
      <td><img src="../images/constraint/constraint_chain_spread_inside.png" width="250"/></td>
      <td> _chainStyle="spread_inside" </td>
     </tr>
     <tr>
     <td><img src="../images/constraint/constraint_chain_weight.png" width="250"/></td>
     <td> _chainStyle="spread" <br> _weight="1" </td>
     </tr>
     <tr>
     <td><img src="../images/constraint/constraint_chain_packed.png" width="250"/></td>
     <td> _chainStyle="packed" </td>
     </tr>
     <tr>
     <td><img src="../images/constraint/constraint_chain_bias.png" width="250"/></td>
     <td> _chainStyle="packed" <br> _bias="0.3"</td>
     </tr>
</table>

<h5 id="2-8-Barrier"><a href="#2-8-Barrier" class="headerlink" title="2.8 Barrier"></a>2.8 Barrier</h5><p>å°†å¤šä¸ªViewçš„æŸä¸€è¾¹çš„æç«¯å€¼ä½œä¸ºçº¦æŸï¼š</p>
<table>
    <tr>
        <td><img src="../images/constraint/constraint_barrier_start.png" width="300"/></td>
        <td><img src="../images/constraint/constraint_barrier_end.png" width="300"/></td>
    </tr>
</table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.Barrier</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:id</span>=<span class="string">&quot;@+id/barrier&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">app:barrierDirection</span>=<span class="string">&quot;start/end&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">app:constraint_referenced_ids</span>=<span class="string">&quot;button1,button2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-9-Groupåˆ†ç»„çº¦æŸ"><a href="#2-9-Groupåˆ†ç»„çº¦æŸ" class="headerlink" title="2.9 Groupåˆ†ç»„çº¦æŸ"></a>2.9 Groupåˆ†ç»„çº¦æŸ</h5><p>å°†å¤šä¸ªViewä½œä¸ºä¸€ä¸ªç»„ä¸€èµ·æ§åˆ¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.Group</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:id</span>=<span class="string">&quot;@+id/group&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:visibility</span>=<span class="string">&quot;visible&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">app:constraint_referenced_ids</span>=<span class="string">&quot;button4,button9&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ— æ³•é€šè¿‡groupè®¾ç½®ç‚¹å‡»äº‹ä»¶<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">group.referencedIds.forEach &#123; id -&gt;</span><br><span class="line">     view.findViewById(id).setOnClickListener &#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-10-Placeholderå ä½çº¦æŸ"><a href="#2-10-Placeholderå ä½çº¦æŸ" class="headerlink" title="2.10 Placeholderå ä½çº¦æŸ"></a>2.10 Placeholderå ä½çº¦æŸ</h5><p>&ensp;&ensp;&ensp;&ensp;Placeholderæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å ä½ç¬¦Viewï¼Œç•Œé¢ä¸Šå…¶ä»–å­˜åœ¨çš„Viewå¯ä»¥é€šè¿‡<code>placeholder.setContentId(R.id.xxx)</code>å°†è‡ªå·±çš„ä½ç½®è®¾ç½®åˆ°placeholderçš„ä½ç½®ï¼ŒåŸä½ç½®è§†å›¾å°†ä¸å¯è§ã€‚<br>&ensp;&ensp;&ensp;&ensp;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Placeholderæ­å»ºä¸€ä¸ªå¸ƒå±€æ¨¡æ¿ï¼Œincludeåˆ°å…¶ä»–å¸ƒå±€å½“ä¸­ï¼Œæ¥å¡«å……æ¨¡æ¿ä¸­çš„è§†å›¾ï¼Œè¿™å°†ä½¿æ‰€æœ‰çš„ç•Œé¢æœ‰ä¸€ä¸ªé€šç”¨çš„æ¨¡æ¿ã€‚</p>
<h5 id="2-11-Guidelineå¼•å¯¼çº¿çº¦æŸ"><a href="#2-11-Guidelineå¼•å¯¼çº¿çº¦æŸ" class="headerlink" title="2.11 Guidelineå¼•å¯¼çº¿çº¦æŸ"></a>2.11 Guidelineå¼•å¯¼çº¿çº¦æŸ</h5><p>Guidelineåªèƒ½åœ¨ConstraintLayoutä¸­ä½¿ç”¨ï¼Œåœ¨æ°´å¹³æˆ–å‚ç›´æ–¹å‘è®¾ç½®è¾…åŠ©å¸ƒå±€çš„ä¸å¯è§çº¿æ¡ã€‚</p>
<table>
<thead>
<tr>
<th>çº¦æŸå±æ€§</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>layout_constraintGuide_begin</td>
<td>è·å¸ƒå±€çš„å·¦è¾¹æˆ–è€…ä¸Šè¾¹xå¤„è®¾ç½®å¼•å¯¼çº¿</td>
</tr>
<tr>
<td>layout_constraintGuide_end</td>
<td>è·å¸ƒå±€å³è¾¹æˆ–ä¸‹é¢xå¤„è®¾ç½®å¼•å¯¼çº¿</td>
</tr>
<tr>
<td>layout_constraintGuide_percent</td>
<td>å®½æˆ–é«˜çš„ç™¾åˆ†ä¹‹xå¤„è®¾ç½®å¼•å¯¼çº¿</td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.Guideline</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/guideline&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintGuide_begin</span>=<span class="string">&quot;100dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;Button&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;@+id/guideline&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸‰ã€åŸç†"><a href="#ä¸‰ã€åŸç†" class="headerlink" title="ä¸‰ã€åŸç†"></a>ä¸‰ã€åŸç†</h4><h5 id="3-1-è§£å†³çº¦æŸé—®é¢˜"><a href="#3-1-è§£å†³çº¦æŸé—®é¢˜" class="headerlink" title="3.1 è§£å†³çº¦æŸé—®é¢˜"></a>3.1 è§£å†³çº¦æŸé—®é¢˜</h5><p>3.1.1 å®šä¹‰å˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x[1], x[2], ... x[n]</span><br></pre></td></tr></table></figure>
<p>3.1.2 å®šä¹‰çº¦æŸé—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a[1]x[1] + ... + a[n]x[n] = b</span><br><span class="line">a[1]x[1] + ... + a[n]x[n] &lt;= b</span><br><span class="line">a[1]x[1] + ... + a[n]x[n] &gt;= b</span><br></pre></td></tr></table></figure>
<p>3.2.3 è®¡ç®—çº¦æŸæ–¹ç¨‹<br>é£Ÿç«é¸¡ç®—æ³•ï¼šé£Ÿç«é¸¡æ˜¯ä¸€ç§ç”Ÿæ´»åœ¨æ–°å‡ å†…äºšçƒ­å¸¦é›¨æ—ä¸­çš„é¸Ÿç±»ï¼Œä»¥æ°´æœä¸ºé£Ÿã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ç§è§£å†³çº¿æ€§æ–¹ç¨‹å’Œçº¿æ€§ä¸ç­‰å¼çš„ç®—æ³•ã€‚1990å¹´åœ¨åç››é¡¿å¤§å­¦è¢«è¯æ˜å’Œå‘ç°ã€‚çº¿æ€§æ–¹ç¨‹éå¸¸é€‚åˆç”¨äºè¡¨ç¤ºç”¨æˆ·ç•Œé¢ä¸­è§†å›¾çš„ä½ç½®ã€å¤§å°ã€ä¸å…¶ä»–è§†å›¾çš„å…³ç³»ã€‚</p>
<h5 id="3-2-ä¸ªäººç†è§£ï¼š"><a href="#3-2-ä¸ªäººç†è§£ï¼š" class="headerlink" title="3.2 ä¸ªäººç†è§£ï¼š"></a>3.2 ä¸ªäººç†è§£ï¼š</h5><p>å®šä¹‰å˜é‡ -&gt; å£°æ˜Viewå¯¹è±¡<br>å®šä¹‰çº¦æŸé—®é¢˜ -&gt; å»ºç«‹Viewä¹‹é—´çš„çº¦æŸå…³ç³»<br>è®¡ç®—çº¦æŸæ–¹ç¨‹ -&gt; è®¡ç®—è§†å›¾çš„å¤§å°ã€åæ ‡  </p>
<h4 id="å››ã€å‚è€ƒæ–‡æ¡£"><a href="#å››ã€å‚è€ƒæ–‡æ¡£" class="headerlink" title="å››ã€å‚è€ƒæ–‡æ¡£"></a>å››ã€å‚è€ƒæ–‡æ¡£</h4><p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/androidx/constraintlayout/widget/ConstraintLayout">1.å®˜æ–¹æ–‡æ¡£</a><br><a target="_blank" rel="noopener" href="https://constraintlayout.com/layouts/">2.åŸºæœ¬ä½¿ç”¨</a><br><a target="_blank" rel="noopener" href="https://biaomingzhong.github.io/2017/constraintlayout-basics-chains-2/">3.åŸºæœ¬ä½¿ç”¨-è¯‘æ–‡</a><br><a target="_blank" rel="noopener" href="https://wiresareobsolete.com/2016/07/constraintlayout-part-1/">4.ConstraintLayout, Inside and Out: Part 1</a><br><a target="_blank" rel="noopener" href="https://wiresareobsolete.com/2016/07/constraintlayout-part-2/">5.ConstraintLayout, Inside and Out: Part 2</a><br><a target="_blank" rel="noopener" href="https://constraints.cs.washington.edu/cassowary/cassowary-tr.pdf">6.çº¿æ€§çº¦æŸè§£å†³ç®—æ³•</a><br><a target="_blank" rel="noopener" href="https://cassowary.readthedocs.io/en/latest/topics/theory.html">7.è§£å†³çº¦æŸ</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/cpu-cache-overview.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/cpu-cache-overview.html" class="post-title-link" itemprop="url">CPUçš„ç¼“å­˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-13 15:28:59" itemprop="dateCreated datePublished" datetime="2021-10-13T15:28:59+08:00">2021-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>971</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ€§èƒ½"><a href="#ä¸€ã€æ€§èƒ½" class="headerlink" title="ä¸€ã€æ€§èƒ½"></a>ä¸€ã€æ€§èƒ½</h4><p>1.1 åœ¨åˆ†å±‚å­˜å‚¨ç»“æ„ä¸­ï¼Œéšç€å­˜å‚¨å®¹é‡çš„å¢åŠ ï¼Œå»¶è¿Ÿä¹Ÿéšä¹‹å¢åŠ ã€‚<a target="_blank" rel="noopener" href="https://gist.github.com/jboner/2841832">å‚è€ƒ</a></p>
<p>ä»æ•°æ®å¯ä»¥çœ‹å‡ºï¼ŒL1ç¼“å­˜å’Œä¸»å­˜è®¿é—®é€Ÿåº¦ç›¸å·®200å€ã€‚</p>
<center>
    <img src="../images/cpu_cache_speed.png" width="500"/>
</center>


<h4 id="äºŒã€ç¼“å­˜è¡Œ"><a href="#äºŒã€ç¼“å­˜è¡Œ" class="headerlink" title="äºŒã€ç¼“å­˜è¡Œ"></a>äºŒã€ç¼“å­˜è¡Œ</h4><p>CPUç¼“å­˜çš„åŸºæœ¬å•ä½æ˜¯ç¼“å­˜è¡Œï¼Œä¸»å­˜æ•°æ®å’Œç¼“å­˜çš„æ˜ å°„å­˜åœ¨ä¸‹åˆ—å…³ç³»ï¼š</p>
<h5 id="2-1-ç›´æ¥æ˜ å°„ç¼“å­˜"><a href="#2-1-ç›´æ¥æ˜ å°„ç¼“å­˜" class="headerlink" title="2.1 ç›´æ¥æ˜ å°„ç¼“å­˜"></a>2.1 ç›´æ¥æ˜ å°„ç¼“å­˜</h5><center>
    <img src="../images/cpu_cache_direct_map.jpeg" width="600"/>
</center>

<p>1ã€ indexç”¨äºè®¡ç®—åœ¨å“ªä¸€ä¸ªç¼“å­˜è¡Œ<br>2ã€ offsetç”¨äºè®¡ç®—åœ¨ç¼“å­˜è¡Œçš„å“ªä¸ªå­—èŠ‚<br>3ã€ tagç”¨äºåˆ¤æ–­ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼ˆå‡è®¾0x7f6601 å’Œ 0x8f6602ä¸¤ä¸ªåœ°å€ï¼Œä½ä½éƒ½ä¸€æ ·ï¼Œç¼“å­˜è¡Œå’Œå­—èŠ‚åç§»éƒ½å‘½ä¸­äº†ï¼Œtagä¸å‘½ä¸­ï¼‰</p>
<p>ç¼ºç‚¹ï¼š<br>å›¾ä¸­ï¼Œcacheç¼“å­˜8è¡Œæ•°æ®ï¼Œå½“è®¿é—®ç¬¬0è¡Œã€ç¬¬8è¡Œã€ç¬¬16è¡Œæ—¶ï¼Œç¼“å­˜æ— æ³•å‘½ä¸­ï¼Œæ¯æ¬¡éƒ½è¦å»ä¸»å­˜åŠ è½½ï¼Œå‘ç”Ÿ<strong>ç¼“å­˜é¢ ç°¸</strong></p>
<h5 id="2-2-å¤šè·¯ç»„ç›¸è¿"><a href="#2-2-å¤šè·¯ç»„ç›¸è¿" class="headerlink" title="2.2 å¤šè·¯ç»„ç›¸è¿"></a>2.2 å¤šè·¯ç»„ç›¸è¿</h5><p>è¿™æ˜¯ä¸€ä¸ªä¸¤è·¯ç»„ç›¸è¿çš„ç¤ºæ„å›¾ï¼š</p>
<center>
    <img src="../images/cpu_cache_n_way.png" width="500"/>
</center>

<p>1ã€indexå®šä½ç»„<br>2ã€ç»„å†…ä¾æ¬¡å¯¹tagè¿›è¡Œå¯¹æ¯”ï¼ˆå¯ä»¥é€šè¿‡ç¡¬ä»¶å¹¶è¡Œæ¯”è¾ƒå¢åŠ æ€§èƒ½ï¼‰</p>
<h4 id="ä¸‰ã€ç¼“å­˜ä¸€è‡´æ€§"><a href="#ä¸‰ã€ç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="ä¸‰ã€ç¼“å­˜ä¸€è‡´æ€§"></a>ä¸‰ã€ç¼“å­˜ä¸€è‡´æ€§</h4><h5 id="3-1-é—®é¢˜æè¿°ï¼š"><a href="#3-1-é—®é¢˜æè¿°ï¼š" class="headerlink" title="3.1 é—®é¢˜æè¿°ï¼š"></a>3.1 é—®é¢˜æè¿°ï¼š</h5><center>
    <img src="../images/cpu_cache_problem.jpeg" width="500"/>
</center>

<p>å¤„ç†å™¨ 1 è¯» X ï¼šä»å†…å­˜è¯»å–24å¹¶ç¼“å­˜<br>å¤„ç†å™¨ 2 è¯» X ï¼šä»å†…å­˜è¯»å–24å¹¶ç¼“å­˜<br>å¤„ç†å™¨ 1 å†™ X = 32 ï¼šæ›´æ–°è‡ªå·±çš„ç¼“å­˜<br>å¤„ç†å™¨ 3 è¯» X = ï¼Ÿ  </p>
<p>å¦‚ä½•ä¿è¯ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Ÿ<a target="_blank" rel="noopener" href="https://people.eecs.berkeley.edu/~pattrsn/252F96/Lecture18.pdf">å‚è€ƒ</a></p>
<h5 id="3-2-è§£å†³æ–¹æ¡ˆ"><a href="#3-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.2 è§£å†³æ–¹æ¡ˆ"></a>3.2 è§£å†³æ–¹æ¡ˆ</h5><p>3.1.1 å—…æ¢-Snooping Solution(Snoopy Bus)</p>
<p>æ ¹æ®å†™æ“ä½œå¯¹ç¼“å­˜æ•°æ®çš„å½±å“å—…æ¢åè®®å¯åˆ†ä¸ºï¼š<br>Write-invalidateï¼š<br>å½“å¤„ç†å™¨å†™å…¥æ•°æ®æ—¶ï¼Œæ‰€æœ‰çš„ç‹¬ç«‹ç¼“å­˜å°†é€šè¿‡æ€»çº¿å—…æ¢å¾—åˆ°é€šçŸ¥ï¼Œå¹¶æ ‡å¿—è‡ªå·±çš„ç¼“å­˜å¤±æ•ˆã€‚è¿™ä¿è¯äº†å…¨å±€åªæœ‰ä¸€ä»½ç¼“å­˜æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<ul>
<li>MSI</li>
<li>MESI</li>
<li>MOSI</li>
<li>MOESI</li>
<li>MESIF </li>
</ul>
<p>Write-updateï¼š<br>å½“å¤„ç†å™¨å†™å…¥æ•°æ®æ—¶ï¼Œæ‰€æœ‰çš„ç‹¬ç«‹ç¼“å­˜å°†é€šè¿‡æ€»çº¿å—…æ¢å¾—åˆ°é€šçŸ¥ï¼Œå¹¶æ›´æ–°è‡ªå·±çš„ç¼“å­˜ã€‚é€šè¿‡æ€»çº¿å¹¿æ’­ç»™æ‰€æœ‰çš„ç¼“å­˜é€ æˆäº†æ€»çº¿ç¹å¿™ï¼Œæ‰€ä»¥ä¸å¸¸è§ã€‚</p>
<p>3.1.2 ç›®å½•-Directory-Based Schemes</p>
<h5 id="3-2-MESIåè®®å‚è€ƒ"><a href="#3-2-MESIåè®®å‚è€ƒ" class="headerlink" title="3.2 MESIåè®®å‚è€ƒ"></a>3.2 MESIåè®®<a target="_blank" rel="noopener" href="https://people.cs.pitt.edu/~melhem/courses/2410p/ch5-4.pdf">å‚è€ƒ</a></h5><p>MESIæ˜¯å››ä¸ªçŠ¶æ€çš„é¦–å­—æ¯ç¼©å†™ï¼Œåœ¨ç¼“å­˜è¡Œä¸­ç”¨2ä¸ªbitæ ‡å¿—è¯¥ç¼“å­˜è¡Œçš„çŠ¶æ€ã€‚</p>
<ul>
<li>M:Modifiedï¼ˆåªå­˜åœ¨å½“å‰ç¼“å­˜è¡Œï¼Œå·²è¢«ä¿®æ”¹ï¼Œå’Œä¸»å­˜ä¸ä¸€è‡´ï¼Œéœ€è¦æ›´æ–°å›ä¸»å­˜ï¼‰</li>
<li>E:Exclusiveï¼ˆåªå­˜åœ¨å½“å‰ç¼“å­˜è¡Œï¼Œå’Œä¸»å­˜ä¸€è‡´ï¼‰</li>
<li>S:Sharedï¼ˆå…¶ä»–ç¼“å­˜è¡Œä¹Ÿå­˜åœ¨è¯¥æ•°æ®ï¼Œå’Œä¸»å­˜ä¸€è‡´ï¼‰</li>
<li>I:Invalidï¼ˆæ­¤ç¼“å­˜è¡Œå¤±æ•ˆï¼‰</li>
</ul>
<p>MESIçš„çŠ¶æ€è¿ç§»ï¼š</p>
<center>
    <img src="../images/cpu_cache_mesi_state.jpeg" width="500"/>
</center>




<h4 id="å››ã€å‚è€ƒæ–‡çŒ®"><a href="#å››ã€å‚è€ƒæ–‡çŒ®" class="headerlink" title="å››ã€å‚è€ƒæ–‡çŒ®"></a>å››ã€å‚è€ƒæ–‡çŒ®</h4><p><a target="_blank" rel="noopener" href="https://www.cnkirito.moe/cache-line/#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98%E8%A1%8C-Cache-Line-%EF%BC%9F">0.Javaè§’åº¦ç†è§£CPUç¼“å­˜</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/102293437">1.Cacheçš„åŸºæœ¬åŸç†</a><br><a target="_blank" rel="noopener" href="https://gist.github.com/jboner/2841832">2.æ¯ä¸ªå¼€å‘è€…éœ€è¦çŸ¥é“çš„æ•°æ®</a><br><a target="_blank" rel="noopener" href="https://medium.com/fcamels-notes/%E5%BE%9E%E7%A1%AC%E9%AB%94%E8%A7%80%E9%BB%9E%E4%BA%86%E8%A7%A3-memry-barrier-%E7%9A%84%E5%AF%A6%E4%BD%9C%E5%92%8C%E6%95%88%E6%9E%9C-416ff0a64fc1">3.ç¡¬ä»¶è§’åº¦çœ‹å†…å­˜å±éšœ</a><br><a target="_blank" rel="noopener" href="https://medium.com/fcamels-notes/%E5%BE%9E-double-checked-locking-%E4%BA%86%E8%A7%A3-memory-barrier-%E7%9A%84%E4%BD%9C%E7%94%A8-bb151a359c1b">4.è½¯ä»¶è§’åº¦å†…å­˜å±éšœ</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3928995/how-do-cache-lines-work">5.stackoverflow-How do cache lines work?</a><br><a target="_blank" rel="noopener" href="https://courses.cs.duke.edu/spring09/cps104/lectures/2up-lecture17.pdf">6.courses-pdf</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/java-object-layout.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/java-object-layout.html" class="post-title-link" itemprop="url">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-03 15:59:09" itemprop="dateCreated datePublished" datetime="2021-10-03T15:59:09+08:00">2021-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.3k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>3 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½æœ‰ä¸€ä¸ªç–‘é—®ï¼šä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨å¤šå¤§çš„ç©ºé—´å‘¢ï¼Ÿ</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jdk8-64/java -jar jol-cli.jar internals java.lang.Object</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Running 64-bit HotSpot VM.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using compressed oop with 3-bit <span class="built_in">shift</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using compressed klass with 3-bit <span class="built_in">shift</span>.</span></span><br><span class="line"></span><br><span class="line">Instantiated the sample instance via default constructor.</span><br><span class="line"></span><br><span class="line">java.lang.Object object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                  VALUE</span><br><span class="line">      0     4        (object header)              05 00 00 00 # Mark word</span><br><span class="line">      4     4        (object header)              00 00 00 00 # Mark word</span><br><span class="line">      8     4        (object header)              00 10 00 00 # (not mark word)</span><br><span class="line">     12     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 16 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡OpenJDKçš„Java-Object-Layoutæˆ‘ä»¬çœ‹åˆ°<code>java.lang.Object</code>çš„ä¸€ä¸ªå®ä¾‹å ç”¨16 bytesã€‚</p>
<p>åŒæ ·çš„<code>java.lang.Boolean</code>ç±»å‹å ç”¨çš„å­—èŠ‚æ•°ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.lang.Boolean object internals:</span><br><span class="line"> OFFSET  SIZE      TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0    12           (object header)                           N/A</span><br><span class="line">     12     1   boolean Boolean.value                             N/A</span><br><span class="line">     13     3           (loss due to the next object alignment)</span><br><span class="line">Instance size: 16 bytes</span><br><span class="line">Space losses: 0 bytes internal + 3 bytes external = 3 bytes total</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[HEADER: 12 bytes]  12 </span><br><span class="line">[value:   1 byte ]  13</span><br><span class="line">[padding: 3 bytes]  16</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¸€ä¸ªå¯¹è±¡é€šå¸¸ç”±ä¸‰å—ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚</p>
<h4 id="äºŒã€å¯¹è±¡å¤´ï¼ˆobject-headerï¼‰"><a href="#äºŒã€å¯¹è±¡å¤´ï¼ˆobject-headerï¼‰" class="headerlink" title="äºŒã€å¯¹è±¡å¤´ï¼ˆobject headerï¼‰"></a>äºŒã€å¯¹è±¡å¤´ï¼ˆobject headerï¼‰</h4><p>åœ¨å‰é¢é€šè¿‡JOLæ‰“å°è¾“å‡ºçš„å…³äºjava.lang.Objectä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°object headerå ç”¨12å­—èŠ‚ï¼Œä½†æ˜¯è¾“å‡ºå¹¶æ²¡æœ‰åŒ…å«è¯¦ç»†çš„ç»“æ„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk/jdk/file/19afeaa0fdbe/src/hotspot/share/oops/oop.hpp#l52">Hotspotçš„æºç </a>äº†è§£åˆ°å¯¹è±¡å¤´åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>mark word</strong>å’Œ<strong>class word</strong>ã€‚</p>
<h5 id="2-1-mark-wordï¼š"><a href="#2-1-mark-wordï¼š" class="headerlink" title="2.1 mark wordï¼š"></a>2.1 <a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk/jdk/file/19afeaa0fdbe/src/hotspot/share/oops/markWord.hpp#l33">mark word</a>ï¼š</h5><p>mark wordåœ¨32ä½å’Œ64ä½æœºåˆ†åˆ«å 32ä½å’Œ64ä½ï¼Œå½“å…¶ä¸­é”æ ‡å¿—ä½çš„å€¼ä¸åŒæ—¶ï¼Œå®ƒå‰é¢çš„bitå­˜å‚¨ä¸åŒçš„å«ä¹‰ã€‚</p>
<ul>
<li>å­˜å‚¨å¯¹è±¡çš„gcå¹´é¾„ä¿¡æ¯</li>
<li>å­˜å‚¨Hashcode</li>
<li>å­˜å‚¨é”ä¿¡æ¯</li>
</ul>
<center>
    <img src="../images/mark-word-64bit.png" width="600"/>
</center>

<h5 id="2-2-class-word"><a href="#2-2-class-word" class="headerlink" title="2.2 class word:"></a>2.2 class word:</h5><p>ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œå¯¹è±¡åªæ˜¯ä¸€ä¸²å­—èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡class-wordè·å–ä¸€äº›å¯¹è±¡çš„å…ƒä¿¡æ¯ï¼Œå®ƒå­˜å‚¨æŒ‡å‘æ–¹æ³•åŒºä¸­è¡¨ç¤ºå¯¹è±¡ç±»å‹çš„æŒ‡é’ˆï¼Œæ¯”å¦‚ä»¥ä¸‹ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥</li>
<li>å†³å®šå¯¹è±¡å¤§å°</li>
<li>è®¡ç®—æ¥å£è°ƒç”¨çš„ç›®æ ‡ç±»</li>
</ul>
<h5 id="2-3-æ•°ç»„é•¿åº¦ï¼š"><a href="#2-3-æ•°ç»„é•¿åº¦ï¼š" class="headerlink" title="2.3 æ•°ç»„é•¿åº¦ï¼š"></a>2.3 æ•°ç»„é•¿åº¦ï¼š</h5><p>å¦‚æœæ˜¯æ•°ç»„ç±»å‹ï¼Œå¯¹è±¡å¤´ä¼šé¢å¤–å­˜å‚¨æ•°ç»„çš„é•¿åº¦ä¿¡æ¯ã€‚</p>
<ul>
<li>å¿«é€Ÿè®¡ç®—å¯¹è±¡çš„å¤§å°</li>
<li>æ•°ç»„è¾¹ç•Œæ£€æŸ¥</li>
</ul>
<h4 id="ä¸‰ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……"><a href="#ä¸‰ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……" class="headerlink" title="ä¸‰ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……"></a>ä¸‰ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……</h4><p>å®ä¾‹æ•°æ®å³æˆ‘ä»¬åœ¨ä»£ç ä¸­å£°æ˜çš„å˜é‡ç­‰ä¿¡æ¯ï¼Œå®ƒçš„å­˜å‚¨å—åˆ°ä¸€äº›è§„åˆ™çš„çº¦æŸä»¥åŠè™šæ‹Ÿæœºå‚æ•°çš„æ§åˆ¶ã€‚</p>
<h5 id="3-1-æ²¡æœ‰å±æ€§çš„ç±»çš„å†…å­˜å¸ƒå±€"><a href="#3-1-æ²¡æœ‰å±æ€§çš„ç±»çš„å†…å­˜å¸ƒå±€" class="headerlink" title="3.1 æ²¡æœ‰å±æ€§çš„ç±»çš„å†…å­˜å¸ƒå±€"></a>3.1 æ²¡æœ‰å±æ€§çš„ç±»çš„å†…å­˜å¸ƒå±€</h5><blockquote>
<p>è§„åˆ™ä¸€ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯å…«å­—èŠ‚å¯¹é½ã€‚</p>
</blockquote>
<p>ä»å‰é¢Objectçš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªæœ‰å¤´éƒ¨ä¿¡æ¯æ—¶å ç”¨16byteï¼Œåˆšå¥½æ˜¯8çš„æ•´æ•°å€ã€‚</p>
<h5 id="3-2-Objectå­ç±»çš„å†…å­˜å¸ƒå±€"><a href="#3-2-Objectå­ç±»çš„å†…å­˜å¸ƒå±€" class="headerlink" title="3.2 Objectå­ç±»çš„å†…å­˜å¸ƒå±€"></a>3.2 Objectå­ç±»çš„å†…å­˜å¸ƒå±€</h5><p>è·Ÿåœ¨å¯¹è±¡å¤´åé¢çš„ç±»å±æ€§æŒ‰ç…§å®ƒä»¬çš„å¤§å°åœ¨å†…å­˜ä¸­æ’åºï¼Œä¾‹å¦‚ï¼šintæ˜¯4å­—èŠ‚ã€longæ˜¯8å­—èŠ‚ã€‚é‡‡ç”¨å­—èŠ‚å¯¹é½å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºä»å†…å­˜è¯»å–4å­—èŠ‚åˆ°4å­—èŠ‚çš„å¯„å­˜å™¨æ€§èƒ½æ›´å¥½ã€‚</p>
<p>ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼ŒSunçš„è™šæ‹Ÿæœºåœ¨åˆ†é…å¯¹è±¡å­—æ®µçš„æ—¶å€™å’Œå®ƒä»¬å£°æ˜çš„é¡ºåºä¸åŒï¼Œæœ‰å¦‚ä¸‹é¡ºåºè§„åˆ™ï¼š</p>
<p>1ã€doubleå’Œlongç±»å‹<br>2ã€intå’Œfloat<br>3ã€shortå’Œchar<br>4ã€booleanå’Œbyte<br>5ã€reference</p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥ä¼˜åŒ–å†…å­˜å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span> a;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">boolean</span> d;</span><br><span class="line">    <span class="keyword">long</span> e;</span><br><span class="line">    Object f;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„å¯¹è±¡å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  8 bytes]  8</span><br><span class="line">[a:       1 byte ]  9</span><br><span class="line">[padding: 3 bytes] 12</span><br><span class="line">[c:       4 bytes] 16</span><br><span class="line">[d:       1 byte ] 17</span><br><span class="line">[padding: 7 bytes] 24</span><br><span class="line">[e:       8 bytes] 32</span><br><span class="line">[f:       4 bytes] 36</span><br><span class="line">[padding: 4 bytes] 40</span><br></pre></td></tr></table></figure>
<p>æ€»å…±ä½¿ç”¨äº†40å­—èŠ‚å†…å­˜ï¼Œå…¶ä¸­14ä¸ªç”¨äºå†…å­˜å¯¹é½è€Œæµªè´¹æ‰ã€‚å¦‚æœé‡æ’é¡ºåºåˆ™ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  8 bytes]  8</span><br><span class="line">[e:       8 bytes] 16</span><br><span class="line">[c:       4 bytes] 20</span><br><span class="line">[a:       1 byte ] 21</span><br><span class="line">[d:       1 byte ] 22</span><br><span class="line">[padding: 2 bytes] 24</span><br><span class="line">[f:       4 bytes] 28</span><br><span class="line">[padding: 4 bytes] 32</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ä¼˜åŒ–ååªæœ‰6ä¸ªå­—èŠ‚ç”¨äºå¯¹é½å¡«å……ï¼Œæ€»å†…å­˜ä¹Ÿåªæœ‰32byteã€‚</p>
<h5 id="3-3-å­ç±»çš„å†…å­˜å¸ƒå±€"><a href="#3-3-å­ç±»çš„å†…å­˜å¸ƒå±€" class="headerlink" title="3.3 å­ç±»çš„å†…å­˜å¸ƒå±€"></a>3.3 å­ç±»çš„å†…å­˜å¸ƒå±€</h5><blockquote>
<p>è§„åˆ™ä¸‰ï¼šç»§æ‰¿ç»“æ„ä¸­å±äºä¸åŒç±»çš„å­—æ®µä¸æ··åˆåœ¨ä¸€èµ·ã€‚çˆ¶ç±»ä¼˜å…ˆï¼Œå­ç±»å…¶æ¬¡ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">   <span class="keyword">long</span> a;</span><br><span class="line">   <span class="keyword">int</span> b;</span><br><span class="line">   <span class="keyword">int</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">   <span class="keyword">long</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Bç±»çš„å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  8 bytes]  8</span><br><span class="line">[a:       8 bytes] 16</span><br><span class="line">[b:       4 bytes] 20</span><br><span class="line">[c:       4 bytes] 24</span><br><span class="line">[d:       8 bytes] 32</span><br></pre></td></tr></table></figure>

<p>å¦‚æœçˆ¶ç±»çš„å­—æ®µä¸ç¬¦åˆ4å­—èŠ‚å¯¹é½ã€‚</p>
<blockquote>
<p>è§„åˆ™å››ï¼šçˆ¶ç±»çš„æœ€åä¸€ä¸ªå­—æ®µå’Œå­ç±»ç¬¬ä¸€ä¸ªå­—æ®µä¹‹é—´å¿…é¡»4å­—èŠ‚å¯¹é½ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">   <span class="keyword">byte</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">   <span class="keyword">byte</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  8 bytes]  8</span><br><span class="line">[a:       1 byte ]  9</span><br><span class="line">[padding: 3 bytes] 12</span><br><span class="line">[b:       1 byte ] 13</span><br><span class="line">[padding: 3 bytes] 16</span><br></pre></td></tr></table></figure>
<p>aåé¢çš„3ä¸ªå­—èŠ‚å°±æ˜¯ä¸ºäº†ä½¿å…¶4å­—èŠ‚å¯¹é½ã€‚è¿™3ä¸ªå­—èŠ‚åªèƒ½æµªè´¹ä¸èƒ½ç»™Bä½¿ç”¨ã€‚</p>
<p>æœ€åä¸€ä¸ªè§„åˆ™å¯ä»¥ç”¨äºèŠ‚çº¦ä¸€äº›å†…å­˜ç©ºé—´ï¼šå½“å­ç±»çš„ç¬¬ä¸€ä¸ªå±æ€§æ˜¯longæˆ–è€…doubleç±»å‹ä¸”çˆ¶ç±»æ²¡æœ‰ä»¥8å­—èŠ‚è¾¹ç•Œç»“æŸã€‚</p>
<blockquote>
<p>è§„åˆ™äº”ï¼šå­ç±»çš„ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯doubelæˆ–longä¸”çˆ¶ç±»æ²¡æœ‰ä»¥8å­—èŠ‚è¾¹ç•Œç»“æŸï¼ŒJVMæ‰“ç ´2çš„è§„åˆ™ï¼Œå…ˆå­˜å‚¨intã€shortã€byteã€referenceæ¥å¡«è¡¥ç©ºç¼ºã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">byte</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> b;</span><br><span class="line">  <span class="keyword">short</span> c;  </span><br><span class="line">  <span class="keyword">byte</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  8 bytes]  8</span><br><span class="line">[a:       1 byte ]  9</span><br><span class="line">[padding: 3 bytes] 12</span><br><span class="line">[c:       2 bytes] 14</span><br><span class="line">[d:       1 byte ] 15</span><br><span class="line">[padding: 1 byte ] 16</span><br><span class="line">[b:       8 bytes] 24</span><br></pre></td></tr></table></figure>

<p>åœ¨å­—èŠ‚12çš„ä½ç½®ï¼ŒAç±»ç»“æŸäº†ã€‚JVMæ‰“ç ´2çš„è§„åˆ™æ”¾å…¥shortå’Œbyteç±»å‹ï¼ŒèŠ‚çº¦äº†4å­—èŠ‚ä¸­çš„3ä¸ªå­—èŠ‚ï¼Œå¦åˆ™å°†æµªè´¹æ‰ã€‚</p>
<h5 id="3-4-æ•°ç»„çš„å†…å­˜å¸ƒå±€"><a href="#3-4-æ•°ç»„çš„å†…å­˜å¸ƒå±€" class="headerlink" title="3.4 æ•°ç»„çš„å†…å­˜å¸ƒå±€"></a>3.4 æ•°ç»„çš„å†…å­˜å¸ƒå±€</h5><p>æ•°ç»„ç±»å‹æœ‰ä¸€ä¸ªé¢å¤–çš„å¤´éƒ¨å­—æ®µä¿å­˜æ•°ç»„çš„é•¿åº¦ï¼Œæ¥ä¸‹æ¥æ˜¯æ•°ç»„çš„å…ƒç´ ï¼Œæ•°ç»„ä½œä¸ºæ™®é€šå¯¹è±¡ä¹Ÿæ˜¯8å­—èŠ‚å¯¹é½çš„ã€‚</p>
<p>è¿™æ˜¯byte[3]çš„å¸ƒå±€ï¼š</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  12 bytes] 12</span><br><span class="line">[[0]:      1 byte ] 13</span><br><span class="line">[[1]:      1 byte ] 14</span><br><span class="line">[[2]:      1 byte ] 15</span><br><span class="line">[padding:  1 byte ] 16</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯long[3]çš„å¸ƒå±€:</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[HEADER:  12 bytes] 12</span><br><span class="line">[padding:  4 bytes] 16</span><br><span class="line">[[0]:      8 bytes] 24</span><br><span class="line">[[1]:      8 bytes] 32</span><br><span class="line">[[2]:      8 bytes] 40</span><br></pre></td></tr></table></figure>

<h5 id="3-5-å†…éƒ¨ç±»çš„å†…å­˜å¸ƒå±€"><a href="#3-5-å†…éƒ¨ç±»çš„å†…å­˜å¸ƒå±€" class="headerlink" title="3.5 å†…éƒ¨ç±»çš„å†…å­˜å¸ƒå±€"></a>3.5 å†…éƒ¨ç±»çš„å†…å­˜å¸ƒå±€</h5><p>éé™æ€å†…éƒ¨ç±»æœ‰ä¸€ä¸ªé¢å¤–çš„éšè—å­—æ®µï¼ŒæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚è¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªå¸¸è§„çš„å¼•ç”¨,å®ƒç¬¦åˆå¯¹è±¡åœ¨å†…å­˜å¸ƒå±€çš„è§„åˆ™ã€‚å†…éƒ¨ç±»å› æ­¤æœ‰4å­—èŠ‚é¢å¤–çš„å¼€é”€ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/java-multithreading-synchronized.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/java-multithreading-synchronized.html" class="post-title-link" itemprop="url">Java synchronized</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-26 22:29:34" itemprop="dateCreated datePublished" datetime="2021-09-26T22:29:34+08:00">2021-09-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>3.7k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>3 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h4><p>synchronizedä½œä¸ºJavaå†…å»ºçš„å…³é”®å­—å’Œé”æœºåˆ¶ï¼Œç†è§£å’Œä½¿ç”¨å®ƒæ˜¯å¿…è¦çš„ä¹Ÿæ˜¯æœ‰éš¾åº¦çš„ã€‚ä¸ªäººè®¤ä¸ºæ·±å…¥ç†è§£æ­¤å…³é”®å­—åœ¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>åŸºç¡€å±‚é¢ï¼šæ­£ç¡®ç†è§£å¯¹è±¡é”å’Œç±»é”ï¼Œå¹¶ç†Ÿç»ƒä½¿ç”¨</li>
<li>èƒ½åŠ›æå‡ï¼š<ul>
<li>äº†è§£å¯¹è±¡çš„å†…å­˜å¸ƒå±€ï¼Œè§‚å¯Ÿé”å¦‚ä½•å½±å“å¯¹è±¡çš„å†…å­˜å¸ƒå±€</li>
<li>äº†è§£é”ä¼˜åŒ–ï¼Œé”å‡çº§åŠå…¶è¿‡ç¨‹</li>
</ul>
</li>
<li>æ›´ä¸Šä¸€å±‚æ¥¼ï¼šOpenJDKæºç èµ°è¯»</li>
</ul>
<p>æœ¬æ–‡åªæ˜¯è®°å½•å’Œç¿»è¯‘äº†ä¸€äº›è‹±æ–‡æ–‡æ¡£çš„å†…å®¹ï¼Œä½œä¸ºç¬”è®°ä»¥åç¿»é˜…ã€‚è¯¦ç»†å†…å®¹å¯çœ‹åŸæ–‡ã€‚</p>
<h4 id="äºŒã€å¯¹è±¡é”å’Œç±»é”"><a href="#äºŒã€å¯¹è±¡é”å’Œç±»é”" class="headerlink" title="äºŒã€å¯¹è±¡é”å’Œç±»é”"></a>äºŒã€å¯¹è±¡é”å’Œç±»é”</h4><p>1.1 å¯¹è±¡é”ï¼šä¿®é¥°ä»£ç å—å’Œå®ä¾‹æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectLock</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;<span class="comment">//æ­¤ä»£ç å—é”ä½å½“å‰å¯¹è±¡</span></span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">                <span class="keyword">while</span> (i-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + i);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">while</span> (i-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>1.2 ç±»é”:ä¿®é¥°ä»£ç å—å’Œé™æ€æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ClazzLock</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ClazzLock.class) &#123;<span class="comment">//æ­¤ä»£ç å—é”ä½classç±»</span></span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">                <span class="keyword">while</span> (i-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + i);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é™æ€æ–¹æ³•å±äºç±»</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">while</span> (i-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; : &quot;</span> + i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸‰ã€é”ä¼˜åŒ–"><a href="#ä¸‰ã€é”ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€é”ä¼˜åŒ–"></a>ä¸‰ã€é”ä¼˜åŒ–</h4><p>ä¾æ®ä¸€ï¼šæ•°æ®æ˜¾ç¤ºï¼Œè®¸å¤šé”æœ‰å±€éƒ¨æ€§ç‰¹å¾ï¼Œä¹Ÿå°±æ˜¯è¯´å¾ˆå¤šé”çš„é”å®šå’Œé‡Šæ”¾éƒ½å‘ç”Ÿåœ¨ç‰¹å®šçš„çº¿ç¨‹ä¸Šã€‚<br>ä¾æ®äºŒï¼šæ•°æ®æ˜¾ç¤ºï¼Œå¤§éƒ¨åˆ†Javaå¯¹è±¡ä¸å­˜åœ¨ç«äº‰ã€‚</p>
<ul>
<li>é€‚åº”æ€§è‡ªæ—‹-Adaptive Spinning</li>
<li>é”æ¶ˆé™¤-Lock Elimination</li>
<li>é”ç²—åŒ–-Lock Coarsening</li>
<li>è½»é‡çº§é”-Lightweight Locking</li>
<li>åå‘é”-Biased Locking</li>
</ul>
<h5 id="3-1-åå‘é”"><a href="#3-1-åå‘é”" class="headerlink" title="3.1 åå‘é”"></a>3.1 åå‘é”</h5><p>å½“æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ¨¡å—æ—¶ï¼Œå…¶ä»–äººå¯èƒ½æŠŠå®ƒç”¨åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ­¤æ—¶åŠ é”é€»è¾‘å°±æ˜¯å¤šä½™çš„ã€‚å³ä½¿ä½¿ç”¨è½»é‡çº§é”ï¼Œæ¯æ¬¡è·å–é”éƒ½æ‰§è¡ŒCASåŸå­æŒ‡ä»¤ä¹Ÿæ˜¯ä¸€ç§æ€§èƒ½æŸè€—ã€‚ä½¿ç”¨åå‘é”ï¼Œçº¿ç¨‹é¦–æ¬¡è·å–é”æ—¶è®°å½•åå‘äºå®ƒè‡ªå·±,å½“æœ‰å…¶ä»–çº¿ç¨‹è·å–é”æ—¶ï¼Œåå‘é”è¦æ’¤é”€ï¼Œä½¿ç”¨å…¶ä»–é”æœºåˆ¶ï¼Œå¦‚è½»é‡çº§é”ã€‚</p>
<p>lock-fieldä¸­æœ‰ä¸€ä¸ªbitç”¨äºè®°å½•æ˜¯å¦åå‘çŠ¶æ€ï¼Œåˆå§‹çŠ¶æ€ä¸‹æ˜¯å¤„äºåå‘é”çŠ¶æ€ï¼Œä½†æ²¡æœ‰è®¾ç½®åå‘çš„çº¿ç¨‹IDã€‚å½“çº¿ç¨‹é¦–æ¬¡è·å–é”æ—¶ï¼Œå‘ç°æ²¡æœ‰æŒ‡å®šåå‘çš„çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨CASè®¾ç½®åå‘çº¿ç¨‹ï¼Œæ¥é¿å…ç«æ€æ¡ä»¶ã€‚</p>
<h5 id="3-2-è½»é‡çº§é”ï¼ˆThin-Lockï¼‰"><a href="#3-2-è½»é‡çº§é”ï¼ˆThin-Lockï¼‰" class="headerlink" title="3.2 è½»é‡çº§é”ï¼ˆThin Lockï¼‰"></a>3.2 è½»é‡çº§é”ï¼ˆThin Lockï¼‰</h5><p>ç›¸å¯¹äºæ¯æ¬¡å¯¹è±¡é”å®šéƒ½è·å–monitorç»“æ„çš„é‡é‡çº§é”è€Œè¨€ï¼Œè½»é‡çº§é”åªæ˜¯ä½¿ç”¨CASåŸå­æŒ‡ä»¤ä¿®æ”¹lock-fieldï¼ˆé”ä¿¡æ¯å­—æ®µï¼‰ï¼Œå› æ­¤è½»é‡çº§é”ä¸æ”¯æŒwaitå’Œnotifyã€‚å½“å‘ç”Ÿé”ç«äº‰æ—¶ï¼Œè½»é‡çº§é”è†¨èƒ€ï¼ŒåŒæ—¶åˆ†é…monitorç»“æ„ï¼Œlock-fieldæ›´æ–°æˆmonitorçš„æŒ‡é’ˆã€‚</p>
<p>Javaçš„é”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥éœ€è¦è®°å½•å½“å‰é”çš„é‡å…¥æ¬¡æ•°å’Œé”çš„æŒæœ‰è€…ã€‚</p>
<ul>
<li>è®°å½•æ–¹å¼ä¸€ï¼š<br>æœ€ç›´æ¥çš„æ–¹å¼æ˜¯æŠŠlock-fieldåˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªè®°å½•é”çš„æŒæœ‰è€…ï¼Œä¸€ä¸ªè®°å½•é”é‡å…¥æ¬¡æ•°ã€‚ç”±äºlock-fieldå­—æ®µé•¿åº¦å›ºå®šï¼Œæ‰€ä»¥é‡å…¥æ¬¡æ•°è¢«é™åˆ¶äº†ã€‚é‡å…¥æ¬¡æ•°è¾¾åˆ°ä¸Šé™åªèƒ½å‡çº§ä¸ºé‡é‡çº§é”ã€‚</li>
</ul>
<ul>
<li>è®°å½•æ–¹å¼äºŒï¼š<br>å½“çº¿ç¨‹éœ€è¦è·å–é”æ—¶ï¼Œåœ¨è·å–é”çš„çº¿ç¨‹æ ˆä¸­ä¿å­˜lock-recordsè®°å½•ã€‚çº¿ç¨‹è·å–çš„æ‰€æœ‰é”è®°å½•éƒ½å°†ä¿å­˜åœ¨è¿™ä¸ªé›†åˆä¸­ï¼Œå®ƒçš„é¡ºåºå’Œè·å–é”çš„é¡ºåºä¸€è‡´ã€‚</li>
</ul>
<p>è½»é‡çº§é”çš„å˜ç§å’Œæå‡åŒ…å« <em>tasuki-lock</em> å’Œ <em>meta-lock</em> å…¶ç®—æ³•æ€æƒ³æ˜¯ä¸€è‡´çš„ï¼Œå·®å¼‚åœ¨äºå®ç°ç»†èŠ‚ï¼Œ</p>
<p>1ã€è½»é‡çº§é”çš„åŠ é”è¿‡ç¨‹</p>
<p>åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€ï¼Œåå‘é”ä½ä¸ºâ€œ0â€ï¼‰è™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼ˆå®˜æ–¹ç§°ä¹‹ä¸º Displaced Mark Wordï¼‰ã€‚ç„¶åï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘object mark wordã€‚å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œå³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œã€‚<br>å¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ï¼Œè½»é‡çº§é”å°±è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼ŒMark Wordä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆï¼Œåé¢ç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿè¦è¿›å…¥é˜»å¡çŠ¶æ€ã€‚<br>è€Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ï¼Œè‡ªæ—‹å°±æ˜¯ä¸ºäº†ä¸è®©çº¿ç¨‹é˜»å¡ï¼Œè€Œé‡‡ç”¨å¾ªç¯å»è·å–é”çš„è¿‡ç¨‹ã€‚</p>
<center>
    <img src="../images/java-thin-lock-recorder.jpg" width="500"/>
</center>

<pre><code>                 å›¾2.1 è½»é‡çº§é”CASæ“ä½œå‰/åå †æ ˆä¸å¯¹è±¡çš„çŠ¶æ€
</code></pre>
<p>2ã€è½»é‡çº§é”çš„è§£é”è¿‡ç¨‹ï¼š</p>
<p>ï¼ˆ1ï¼‰é€šè¿‡CASæ“ä½œå°è¯•æŠŠçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordå¯¹è±¡æ›¿æ¢å½“å‰çš„Mark Wordã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœæ›¿æ¢æˆåŠŸï¼Œæ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±å®Œæˆäº†ã€‚</p>
<p>ï¼ˆ3ï¼‰å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼ˆæ­¤æ—¶é”å·²è†¨èƒ€ï¼‰ï¼Œé‚£å°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p>
<h5 id="3-3-é”æ¶ˆé™¤"><a href="#3-3-é”æ¶ˆé™¤" class="headerlink" title="3.3 é”æ¶ˆé™¤"></a>3.3 é”æ¶ˆé™¤</h5><p>é”æ¶ˆé™¤å³åˆ é™¤ä¸å¿…è¦çš„åŠ é”æ“ä½œã€‚æ ¹æ®ä»£ç é€ƒé€¸æŠ€æœ¯ï¼Œå¦‚æœåˆ¤æ–­åˆ°ä¸€æ®µä»£ç ä¸­ï¼Œå †ä¸Šçš„æ•°æ®ä¸ä¼šé€ƒé€¸å‡ºå½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™æ®µä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸å¿…è¦åŠ é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        contactString(<span class="string">&quot;aa&quot;</span>, <span class="string">&quot;bb&quot;</span>, <span class="string">&quot;cc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">contactString</span><span class="params">(String s1, String s2, String s3)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringBuffer().append(s1).append(s2).append(s3).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶StringBufferçš„appendæ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œä½†æ˜¯è¿™æ®µç¨‹åºä¸­çš„StringBufferå±äºä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¹¶ä¸”ä¸ä¼šä»è¯¥æ–¹æ³•ä¸­é€ƒé€¸å‡ºå»ï¼Œæ‰€ä»¥å…¶å®è¿™è¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å°†é”æ¶ˆé™¤ã€‚</p>
<h5 id="3-4-é”ç²—åŒ–"><a href="#3-4-é”ç²—åŒ–" class="headerlink" title="3.4 é”ç²—åŒ–"></a>3.4 é”ç²—åŒ–</h5><p>è™šæ‹Ÿæœºå¯¹è¿ç»­çš„åŠ é”æ“ä½œï¼ˆsynchronized appendï¼‰è¿›è¡ŒèŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">concatString</span><span class="params">(String s1,String s2, String s3)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBUffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    sb.append(s3);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å››ã€å‚è€ƒèµ„æ–™"><a href="#å››ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å››ã€å‚è€ƒèµ„æ–™"></a>å››ã€å‚è€ƒèµ„æ–™</h4><p>1.Evaluating and improving biased locking in the HotSpot virtual machine<br>2.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/paddix/p/5405678.html">Javaå¹¶å‘ç¼–ç¨‹ï¼šSynchronizedåº•å±‚ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰</a><br>3.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhai1997/p/13546652.html">é”ï¼šé”ä¼˜åŒ–ï¼ˆsynchronized é”å‡çº§è¿‡ç¨‹ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ï¼‰</a><br>4.<a target="_blank" rel="noopener" href="https://wiki.openjdk.java.net/display/HotSpot/Synchronization">Synchronization</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/kotlin-lang-flow.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/kotlin-lang-flow.html" class="post-title-link" itemprop="url">Kotlin Flow åŸºç¡€</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-25 15:27:31" itemprop="dateCreated datePublished" datetime="2021-09-25T15:27:31+08:00">2021-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>5 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="ä¸€ã€ä»€ä¹ˆæ˜¯Flow"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯Flow" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯Flow"></a>ä¸€ã€ä»€ä¹ˆæ˜¯Flow</h4><h5 id="1ã€å¦‚ä½•é€šè¿‡åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼ï¼Ÿ"><a href="#1ã€å¦‚ä½•é€šè¿‡åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•é€šè¿‡åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼ï¼Ÿ"></a>1ã€å¦‚ä½•é€šè¿‡åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼ï¼Ÿ</h5><p>1.1 åŒæ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: List&lt;<span class="built_in">Int</span>&gt; = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    simple().forEach &#123; value -&gt; println(value) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.2 åŒæ­¥æ–¹å¼<strong>ä¾æ¬¡</strong>è¿”å›å¤šä¸ªå€¼</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: Sequence&lt;<span class="built_in">Int</span>&gt; = sequence &#123; <span class="comment">// sequence builder</span></span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>) <span class="comment">// pretend we are computing it</span></span><br><span class="line">        yield(i) <span class="comment">// yield next value</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    simple().forEach &#123; value -&gt; println(<span class="string">&quot;time = <span class="subst">$&#123;System.currentTimeMillis()&#125;</span> ,<span class="variable">$value</span>&quot;</span>) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>1.3 å¼‚æ­¥æ–¹å¼è¿”å›å¤šä¸ªå€¼</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    delay(<span class="number">1000</span>) <span class="comment">// pretend we are doing something asynchronous here</span></span><br><span class="line">    <span class="keyword">return</span> listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    simple().forEach &#123; value -&gt; println(value) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.4 å¦‚ä½•é€šè¿‡å¼‚æ­¥çš„æ–¹å¼<strong>ä¾æ¬¡</strong>è¿”å›å¤šä¸ªå€¼å‘¢ï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: Flow&lt;<span class="built_in">Int</span>&gt; = flow &#123; <span class="comment">// flow builder</span></span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">        delay(<span class="number">100</span>) <span class="comment">// pretend we are doing something useful here</span></span><br><span class="line">        emit(i) <span class="comment">// emit next value</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// Launch a concurrent coroutine to check if the main thread is blocked</span></span><br><span class="line">    launch &#123;</span><br><span class="line">        <span class="keyword">for</span> (k <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">            println(<span class="string">&quot;I&#x27;m not blocked <span class="variable">$k</span>&quot;</span>)</span><br><span class="line">            delay(<span class="number">100</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Collect the flow</span></span><br><span class="line">    simple().collect &#123; value -&gt; println(value) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é€šè¿‡flowï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¼‚æ­¥çš„æ•°æ®æµã€‚</strong></p>
<h5 id="2ã€Flowæ˜¯å†·æ•°æ®æµ"><a href="#2ã€Flowæ˜¯å†·æ•°æ®æµ" class="headerlink" title="2ã€Flowæ˜¯å†·æ•°æ®æµ"></a>2ã€Flowæ˜¯å†·æ•°æ®æµ</h5><p>å†·æ•°æ®æµï¼šæ¯æ¬¡è°ƒç”¨<code>collect</code>å‡½æ•°æ—¶éƒ½ä¼šè§¦å‘æ‰§è¡Œ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: Flow&lt;<span class="built_in">Int</span>&gt; = flow &#123; </span><br><span class="line">    println(<span class="string">&quot;Flow started&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">        delay(<span class="number">100</span>)</span><br><span class="line">        emit(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    println(<span class="string">&quot;Calling simple function...&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> flow = simple()</span><br><span class="line">    println(<span class="string">&quot;Calling collect...&quot;</span>)</span><br><span class="line">    flow.collect &#123; value -&gt; println(value) &#125; </span><br><span class="line">    println(<span class="string">&quot;Calling collect again...&quot;</span>)</span><br><span class="line">    flow.collect &#123; value -&gt; println(value) &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3ã€Flowçš„å–æ¶ˆ"><a href="#3ã€Flowçš„å–æ¶ˆ" class="headerlink" title="3ã€Flowçš„å–æ¶ˆ"></a>3ã€Flowçš„å–æ¶ˆ</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: Flow&lt;<span class="built_in">Int</span>&gt; = flow &#123; </span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">        delay(<span class="number">100</span>)          </span><br><span class="line">        println(<span class="string">&quot;Emitting <span class="variable">$i</span>&quot;</span>)</span><br><span class="line">        emit(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    withTimeoutOrNull(<span class="number">250</span>) &#123; <span class="comment">// Timeout after 250ms </span></span><br><span class="line">        simple().collect &#123; value -&gt; println(value) &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Done&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h5 id="4ã€å¦‚ä½•æ„å»ºFlowï¼Ÿ"><a href="#4ã€å¦‚ä½•æ„å»ºFlowï¼Ÿ" class="headerlink" title="4ã€å¦‚ä½•æ„å»ºFlowï¼Ÿ"></a>4ã€å¦‚ä½•æ„å»ºFlowï¼Ÿ</h5><ul>
<li><code>flow&#123; ... &#125;</code></li>
<li><code>flowOf</code></li>
<li><code>.asFlow()</code></li>
</ul>
<h5 id="5ã€Flowæ“ä½œç¬¦"><a href="#5ã€Flowæ“ä½œç¬¦" class="headerlink" title="5ã€Flowæ“ä½œç¬¦"></a>5ã€Flowæ“ä½œç¬¦</h5><p>5.1 ä¸­é—´æ“ä½œç¬¦</p>
<ul>
<li>map</li>
<li>filter</li>
<li>transform</li>
<li>take</li>
</ul>
<p>5.2 ç»ˆæ­¢æ“ä½œç¬¦</p>
<ul>
<li>collect</li>
<li>toList / toSet</li>
<li>first / single</li>
<li>reduce / fold</li>
</ul>
<p>5.3 <code>buffer</code>å½“æµçš„å¤„ç†é€Ÿåº¦æ…¢äºå‘å°„é€Ÿåº¦æ—¶ï¼Œé€šè¿‡bufferæå‰ç¼“å­˜å¯ä»¥æé«˜æ•ˆç‡ï¼š </p>
<p>ä¼˜åŒ–å‰ï¼šè€—æ—¶1200ms</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">simple</span><span class="params">()</span></span>: Flow&lt;<span class="built_in">Int</span>&gt; = flow &#123;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span>) &#123;</span><br><span class="line">        delay(<span class="number">100</span>) <span class="comment">// pretend we are asynchronously waiting 100 ms</span></span><br><span class="line">        emit(i) <span class="comment">// emit next value</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123; </span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        simple().collect &#123; value -&gt; </span><br><span class="line">            delay(<span class="number">300</span>) <span class="comment">// pretend we are processing it for 300 ms</span></span><br><span class="line">            println(value) </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;   </span><br><span class="line">    println(<span class="string">&quot;Collected in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼˜åŒ–åï¼šè€—æ—¶1000ms</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">    simple()</span><br><span class="line">        .buffer() <span class="comment">// buffer emissions, don&#x27;t wait</span></span><br><span class="line">        .collect &#123; value -&gt; </span><br><span class="line">            delay(<span class="number">300</span>) <span class="comment">// pretend we are processing it for 300 ms</span></span><br><span class="line">            println(value) </span><br><span class="line">        &#125; </span><br><span class="line">&#125;   </span><br><span class="line">println(<span class="string">&quot;Collected in <span class="variable">$time</span> ms&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>5.4 <code>conflate</code>å½“ç”Ÿäº§é€Ÿåº¦å¤§äºæ¶ˆè´¹é€Ÿåº¦ï¼Œå¿½ç•¥æœªæ¥å¾—åŠå¤„ç†çš„å€¼</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">    simple()</span><br><span class="line">        .conflate() <span class="comment">// conflate emissions, don&#x27;t process each one</span></span><br><span class="line">        .collect &#123; value -&gt; </span><br><span class="line">            delay(<span class="number">300</span>) <span class="comment">// pretend we are processing it for 300 ms</span></span><br><span class="line">            println(value) </span><br><span class="line">        &#125; </span><br><span class="line">&#125;   </span><br><span class="line">println(<span class="string">&quot;Collected in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line"><span class="comment">//è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="comment">//Collected in 758 ms</span></span><br></pre></td></tr></table></figure>

<p>5.5 <code>collectLatest</code> å¦‚æœæ¶ˆè´¹è€…å¾ˆæ…¢ï¼Œå–æ¶ˆå®ƒï¼Œæ–°å€¼è¿‡æ¥æ—¶å†é‡æ–°å¯åŠ¨ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">    simple()</span><br><span class="line">        .collectLatest &#123; value -&gt; <span class="comment">// cancel &amp; restart on the latest value</span></span><br><span class="line">            println(<span class="string">&quot;Collecting <span class="variable">$value</span>&quot;</span>) </span><br><span class="line">            delay(<span class="number">300</span>) <span class="comment">// pretend we are processing it for 300 ms</span></span><br><span class="line">            println(<span class="string">&quot;Done <span class="variable">$value</span>&quot;</span>) </span><br><span class="line">        &#125; </span><br><span class="line">&#125;   </span><br><span class="line">println(<span class="string">&quot;Collected in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//Collecting 1</span></span><br><span class="line"><span class="comment">//Collecting 2</span></span><br><span class="line"><span class="comment">//Collecting 3</span></span><br><span class="line"><span class="comment">//Done 3</span></span><br><span class="line"><span class="comment">//Collected in 741 ms</span></span><br></pre></td></tr></table></figure>

<p>5.6 å¤šä¸ªflowåˆå¹¶ï¼šzip / combine  </p>
<p>ä½¿ç”¨<code>zip</code>æ“ä½œç¬¦</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> nums = (<span class="number">1.</span><span class="number">.3</span>).asFlow() <span class="comment">// numbers 1..3</span></span><br><span class="line"><span class="keyword">val</span> strs = flowOf(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>) <span class="comment">// strings </span></span><br><span class="line">nums.zip(strs) &#123; a, b -&gt; <span class="string">&quot;<span class="variable">$a</span> -&gt; <span class="variable">$b</span>&quot;</span> &#125; <span class="comment">// compose a single string</span></span><br><span class="line">    .collect &#123; println(it) &#125; <span class="comment">// collect and print</span></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//1 -&gt; one</span></span><br><span class="line"><span class="comment">//2 -&gt; two</span></span><br><span class="line"><span class="comment">//3 -&gt; three</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸¤ä¸ªflowä¸åŒæ­¥æ—¶ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€Ÿåº¦ä¸åŒæ­¥æ—¶ï¼Œä½¿ç”¨zipï¼Œåˆ°è¾¾åŒæ­¥ç‚¹æ‰è¾“å‡º</span></span><br><span class="line"><span class="keyword">val</span> nums = (<span class="number">1.</span><span class="number">.3</span>).asFlow().onEach &#123; delay(<span class="number">300</span>) &#125; <span class="comment">// numbers 1..3 every 300 ms</span></span><br><span class="line"><span class="keyword">val</span> strs = flowOf(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>).onEach &#123; delay(<span class="number">400</span>) &#125; <span class="comment">// strings every 400 ms</span></span><br><span class="line"><span class="keyword">val</span> startTime = System.currentTimeMillis() <span class="comment">// remember the start time </span></span><br><span class="line">nums.zip(strs) &#123; a, b -&gt; <span class="string">&quot;<span class="variable">$a</span> -&gt; <span class="variable">$b</span>&quot;</span> &#125; <span class="comment">// compose a single string with &quot;zip&quot;</span></span><br><span class="line">    .collect &#123; value -&gt; <span class="comment">// collect and print </span></span><br><span class="line">        println(<span class="string">&quot;<span class="variable">$value</span> at <span class="subst">$&#123;System.currentTimeMillis() - startTime&#125;</span> ms from start&quot;</span>) </span><br><span class="line">    &#125; </span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//1 -&gt; one at 428 ms from start</span></span><br><span class="line"><span class="comment">//2 -&gt; two at 828 ms from start</span></span><br><span class="line"><span class="comment">//3 -&gt; three at 1230 ms from start</span></span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////é€Ÿåº¦ä¸åŒæ­¥æ—¶ï¼Œä½¿ç”¨combineï¼Œæœ‰å€¼åˆ°è¾¾å³è¾“å‡ºï¼Œæ— è§†åŒæ­¥</span></span><br><span class="line"><span class="keyword">val</span> nums = (<span class="number">1.</span><span class="number">.3</span>).asFlow().onEach &#123; delay(<span class="number">300</span>) &#125; <span class="comment">// numbers 1..3 every 300 ms</span></span><br><span class="line"><span class="keyword">val</span> strs = flowOf(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>).onEach &#123; delay(<span class="number">400</span>) &#125; <span class="comment">// strings every 400 ms          </span></span><br><span class="line"><span class="keyword">val</span> startTime = System.currentTimeMillis() <span class="comment">// remember the start time </span></span><br><span class="line">nums.combine(strs) &#123; a, b -&gt; <span class="string">&quot;<span class="variable">$a</span> -&gt; <span class="variable">$b</span>&quot;</span> &#125; <span class="comment">// compose a single string with &quot;combine&quot;</span></span><br><span class="line">    .collect &#123; value -&gt; <span class="comment">// collect and print </span></span><br><span class="line">        println(<span class="string">&quot;<span class="variable">$value</span> at <span class="subst">$&#123;System.currentTimeMillis() - startTime&#125;</span> ms from start&quot;</span>) </span><br><span class="line">    &#125; </span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//1 -&gt; one at 452 ms from start</span></span><br><span class="line"><span class="comment">//2 -&gt; one at 651 ms from start</span></span><br><span class="line"><span class="comment">//2 -&gt; two at 854 ms from start</span></span><br><span class="line"><span class="comment">//3 -&gt; two at 952 ms from start</span></span><br><span class="line"><span class="comment">//3 -&gt; three at 1256 ms from start</span></span><br></pre></td></tr></table></figure>


<p>å‚è€ƒæ–‡æ¡£ï¼š<br><a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/flow.html"> 1.å®˜æ–¹æ–‡æ¡£</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangduwei.top/basic-encryption-algorithm.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangduwei">
      <meta itemprop="description" content="è€å¿ƒå’ŒåšæŒ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è“è‰²çš„ç¬”è®°æœ¬">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/basic-encryption-algorithm.html" class="post-title-link" itemprop="url">å¯¹ç§°/éå¯¹ç§°åŠ å¯†å’Œæ•°å­—ç­¾å</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-14 21:31:08" itemprop="dateCreated datePublished" datetime="2021-09-14T21:31:08+08:00">2021-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-29 19:50:54" itemprop="dateModified" datetime="2024-04-29T19:50:54+08:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœº</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-å¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š"><a href="#1-å¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š" class="headerlink" title="1.å¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š"></a>1.å¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š</h4><p>ï¼ˆå¤§å®¶ç”¨ç›¸åŒçš„é’¥åŒ™æ¥è¿›è¡ŒåŠ è§£å¯†ï¼‰<br><del>å‘é€ç«¯å’Œæ¥æ”¶ç«¯é¦–å…ˆè¦å…±äº«ç›¸åŒçš„å¯†é’¥k(å³é€šä¿¡å‰åŒæ–¹éƒ½éœ€è¦çŸ¥é“å¯¹åº”çš„å¯†é’¥)æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚å‘é€ç«¯ç”¨å…±äº«å¯†é’¥kå¯¹æ˜æ–‡pè¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡cï¼Œå¹¶å°†å¾—åˆ°çš„å¯†æ–‡å‘é€ç»™æ¥æ”¶ç«¯ï¼Œæ¥æ”¶ç«¯æ”¶åˆ°å¯†æ–‡åï¼Œå¹¶ç”¨å…¶ç›¸åŒçš„å…±äº«å¯†é’¥kå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¾—å‡ºæ˜æ–‡pã€‚</del></p>
<p>ä¸€èˆ¬åŠ å¯†å’Œè§£å¯†çš„ç®—æ³•æ˜¯å…¬å¼€çš„ï¼Œéœ€è¦ä¿æŒéšç§˜çš„æ˜¯å¯†é’¥k<br>æµè¡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼šDESï¼ŒTriple-DESï¼ŒRC2å’ŒRC4ï¼ŒAES</p>
<h5 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul>
<li>å‘é€æ–¹å’Œæ¥æ”¶æ–¹é¦–å…ˆéœ€è¦å…±äº«ç›¸åŒçš„å¯†é’¥ï¼Œå³å­˜åœ¨å¯†é’¥kçš„åˆ†å‘é—®é¢˜ï¼Œå¦‚ä½•å®‰å…¨çš„æŠŠå…±äº«å¯†é’¥åœ¨åŒæ–¹è¿›è¡Œåˆ†äº«ï¼Œè¿™æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¦‚ä½•å®‰å…¨é€šä¿¡çš„é—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯æå‰åŒæ–¹çº¦å®šå¥½ï¼Œä¸é€šè¿‡å…·ä½“çš„é€šä¿¡è¿›è¡Œåå•†ï¼Œé¿å…è¢«ç›‘å¬å’Œæˆªè·ã€‚å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå°†æ˜¯ä¸‹é¢æˆ‘ä»¬ä»‹ç»çš„é€šè¿‡éå¯¹ç§°åŠ å¯†ä¿¡é“è¿›è¡Œå¯¹ç§°å¯†ç çš„åˆ†å‘å’Œå…±äº«ï¼Œå³æ··åˆåŠ å¯†ç³»ç»Ÿã€‚</li>
<li>å¯†é’¥ç®¡ç†çš„å¤æ‚åº¦é—®é¢˜ã€‚ç”±äºå¯¹ç§°åŠ å¯†çš„å¯†é’¥æ˜¯ä¸€å¯¹ä¸€çš„ä½¿ç”¨æ–¹å¼ï¼Œè‹¥ä¸€æ–¹è¦è·Ÿnæ–¹é€šä¿¡ï¼Œåˆ™éœ€è¦ç»´æŠ¤nå¯¹å¯†é’¥ã€‚</li>
</ul>
<h5 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul>
<li>åŠ å¯†å’Œè§£å¯†çš„é€Ÿåº¦è¦æ¯”éå¯¹ç§°åŠ å¯†å¿«å¾ˆå¤šï¼Œå› æ­¤å¸¸ç”¨éå¯¹ç§°åŠ å¯†å»ºç«‹çš„å®‰å…¨ä¿¡é“è¿›è¡Œå…±äº«å¯†é’¥çš„åˆ†äº«ï¼Œå®Œæˆåï¼Œå…·ä½“çš„åŠ è§£å¯†åˆ™ä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚å³æ··åˆåŠ å¯†ç³»ç»Ÿã€‚</li>
</ul>
<p>å¦å¤–ä¸€ä¸ªç‚¹éœ€è¦é‡ç‚¹è¯´æ˜çš„æ˜¯ï¼Œå¯†é’¥kçš„é•¿åº¦å¯¹è§£å¯†ç ´è§£çš„éš¾åº¦æœ‰å¾ˆé‡å¤§çš„å½±å“ï¼Œkçš„é•¿åº¦è¶Šé•¿ï¼Œå¯¹åº”çš„å¯†ç ç©ºé—´å°±è¶Šå¤§ï¼Œé­åˆ°æš´åŠ›ç ´è§£æˆ–è€…è¯å…¸ç ´è§£çš„éš¾åº¦å°±æ›´å¤§ï¼Œå°±æ›´åŠ å®‰å…¨ã€‚</p>
<center>
    <img src="../images/dcjm.png" width="400"/>
</center>

<h4 id="2-æ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼š"><a href="#2-æ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼š" class="headerlink" title="2.æ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼š"></a>2.æ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼š</h4><ul>
<li>å‘é€æ–¹Aé¦–å…ˆå¯¹å˜é•¿çš„æŠ¥æ–‡æå–æˆä¸€ä¸ªå®šé•¿çš„æ‘˜è¦ï¼Œä¸€èˆ¬æ˜¯md5ç­‰</li>
<li>Aå¯¹æ‘˜è¦åº”ç”¨äº†ä¸€ä¸ªç­¾åå‡½æ•°ï¼Œå¹¶ä¸”ç”¨Aè‡ªå·±çš„ç§é’¥ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºåªæœ‰Aæ‰çŸ¥é“ç§é’¥ï¼Œæ‰€ä»¥æ­£ç¡®çš„ç­¾åä¼šè¯´æ˜ç­¾åè€…å°±æ˜¯å…¶æ‰€æœ‰è€…ã€‚</li>
<li>ä¸€æ—¦è®¡ç®—å‡ºç­¾åï¼ŒèŠ‚ç‚¹Aå°±å°†å…¶é™„åŠ åˆ°æŠ¥æ–‡çš„æœ«å°¾ï¼Œå¹¶å°†æŠ¥æ–‡å’Œç­¾åä¸€èµ·éƒ½å‘é€ç»™B</li>
<li>åœ¨æ¥æ”¶ç«¯Bï¼Œé¦–å…ˆä¼šæŒ‰ç…§åŒæ ·çš„ç®—æ³•è®¡ç®—å‡ºæŠ¥æ–‡çš„æ‘˜è¦ï¼Œç„¶åå¯¹ç­¾åç”¨Açš„å…¬é’¥è¿›è¡Œè§£ç ï¼Œå¾—å‡ºè§£ç åçš„æ‘˜è¦ï¼Œä¸¤ä¸ªæ‘˜è¦è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯Aå‘é€çš„ä¸”å†…å®¹æ²¡è¢«ç¯¡æ”¹è¿‡ã€‚</li>
</ul>
<center>
    <img src="../images/szqm.png" width="400"/>
</center>


<h4 id="3-éå¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š"><a href="#3-éå¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š" class="headerlink" title="3.éå¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š"></a>3.éå¯¹ç§°åŠ è§£å¯†çš„è¿‡ç¨‹ï¼š</h4><p>åŠ å¯†ä¸€æ–¹æ‰¾åˆ°æ¥æ”¶æ–¹çš„å…¬é’¥e (å¦‚ä½•æ‰¾åˆ°å‘¢ï¼Ÿå¤§éƒ¨åˆ†çš„å…¬é’¥æŸ¥æ‰¾å·¥ä½œå®é™…ä¸Šéƒ½æ˜¯é€šè¿‡æ•°å­—è¯ä¹¦æ¥å®ç°çš„)ï¼Œç„¶åç”¨å…¬é’¥eå¯¹æ˜æ–‡pè¿›è¡ŒåŠ å¯†åå¾—åˆ°å¯†æ–‡cï¼Œå¹¶å°†å¾—åˆ°çš„å¯†æ–‡å‘é€ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å¯†æ–‡åï¼Œç”¨è‡ªå·±ä¿ç•™çš„ç§é’¥dè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡pï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šç”¨å…¬é’¥åŠ å¯†çš„å¯†æ–‡ï¼Œåªæœ‰æ‹¥æœ‰ç§é’¥çš„ä¸€æ–¹æ‰èƒ½è§£å¯†ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³åŠ å¯†çš„å„æ–¹å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªå…¬é’¥å³å¯ã€‚</p>
<p>å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼šRSA</p>
<h5 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul>
<li>ä¸å­˜åœ¨å¯†é’¥åˆ†å‘çš„é—®é¢˜ï¼Œè§£ç æ–¹å¯ä»¥è‡ªå·±ç”Ÿæˆå¯†é’¥å¯¹ï¼Œä¸€ä¸ªåšç§é’¥å­˜èµ·æ¥ï¼Œå¦å¤–ä¸€ä¸ªä½œä¸ºå…¬é’¥è¿›è¡Œå‘å¸ƒã€‚</li>
<li>è§£å†³äº†å¯†é’¥ç®¡ç†çš„å¤æ‚åº¦é—®é¢˜ï¼Œå¤šä¸ªåŠ å¯†æ–¹éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·²çŸ¥çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œä½†åªæœ‰æ‹¥æœ‰ç§é’¥çš„ä¸€æ–¹æ‰èƒ½è§£å¯†ã€‚</li>
</ul>
<h5 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul>
<li>éå¯¹ç§°åŠ å¯†ä¸è¶³çš„åœ°æ–¹æ˜¯åŠ è§£å¯†çš„é€Ÿåº¦æ²¡æœ‰å¯¹ç§°åŠ å¯†å¿«ã€‚</li>
</ul>
<p>ç»¼ä¸Šï¼Œåˆ†æäº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†å„è‡ªçš„ä¼˜ç¼ºç‚¹åï¼Œæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•æ˜¯å¯ä»¥åˆ©ç”¨ä¸¤è€…çš„ä¼˜ç‚¹ä½†é¿å¼€å¯¹åº”çš„ç¼ºç‚¹å‘¢ï¼Ÿç­”åº”æ˜¯æœ‰çš„ï¼Œå®é™…ä¸Šç”¨å¾—æœ€å¤šçš„æ˜¯æ··åˆåŠ å¯†ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨ä¸¤ä¸ªèŠ‚ç‚¹é—´é€šè¿‡ä¾¿æ·çš„å…¬å¼€å¯†ç åŠ å¯†æŠ€æœ¯å»ºç«‹èµ·å®‰å…¨é€šä¿¡ï¼Œç„¶åå†ç”¨å®‰å…¨çš„é€šä¿¡äº§ç”Ÿå¹¶å‘é€ä¸´æ—¶çš„éšæœºå¯¹ç§°å¯†é’¥ï¼Œé€šè¿‡æ›´å¿«çš„å¯¹ç§°åŠ å¯†æŠ€æœ¯å¯¹å‰©ä½™çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</p>
<center>
    <img src="../images/fdcjm.png" width="400"/>
</center>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/archives/page/3/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/archives/page/5/">5</a><a class="extend next" rel="next" href="/archives/page/5/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">wangduwei</p>
  <div class="site-description" itemprop="description">è€å¿ƒå’ŒåšæŒ</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangduwei</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">130k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">1:58</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













  

  


  <!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ -->
  
        <script type="text/javascript" src="/js/love.js"></script>
  
</body>
</html>
