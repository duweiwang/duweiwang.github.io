<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ğŸ“Œ å‰è¨€åœ¨å¼€å§‹ä½¿ç”¨ Kotlin åç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ„è¯†åˆ°ä¸€äº›åº”å½“åšå’Œä¸åº”å½“åšçš„äº‹é¡¹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚å¸¸å¤„ç†ã€ä½œç”¨åŸŸç®¡ç†å’Œå¹¶å‘æ¨¡å¼æ–¹é¢ã€‚æœ¬æ–‡æ€»ç»“äº†å¤šç§åç¨‹ä½¿ç”¨ä¸­çš„æ¨¡å¼ä¸åæ¨¡å¼ï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ¸…æ™°ã€å¯ç»´æŠ¤çš„åç¨‹ä»£ç ã€‚  ğŸ§  1. æŠŠ async è°ƒç”¨åŒ…è£¹åœ¨ coroutineScope æˆ–ä½¿ç”¨ SupervisorJob æ¥å¤„ç†å¼‚å¸¸âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try&#x2F;catch">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰">
<meta property="og:url" content="https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html">
<meta property="og:site_name" content="è“è‰²çš„ç¬”è®°æœ¬">
<meta property="og:description" content="ğŸ“Œ å‰è¨€åœ¨å¼€å§‹ä½¿ç”¨ Kotlin åç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ„è¯†åˆ°ä¸€äº›åº”å½“åšå’Œä¸åº”å½“åšçš„äº‹é¡¹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚å¸¸å¤„ç†ã€ä½œç”¨åŸŸç®¡ç†å’Œå¹¶å‘æ¨¡å¼æ–¹é¢ã€‚æœ¬æ–‡æ€»ç»“äº†å¤šç§åç¨‹ä½¿ç”¨ä¸­çš„æ¨¡å¼ä¸åæ¨¡å¼ï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ¸…æ™°ã€å¯ç»´æŠ¤çš„åç¨‹ä»£ç ã€‚  ğŸ§  1. æŠŠ async è°ƒç”¨åŒ…è£¹åœ¨ coroutineScope æˆ–ä½¿ç”¨ SupervisorJob æ¥å¤„ç†å¼‚å¸¸âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try&#x2F;catch">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-31T09:57:01.000Z">
<meta property="article:modified_time" content="2025-12-31T09:57:01.256Z">
<meta property="article:author" content="wangduwei">
<meta property="article:tag" content="Kotlin">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="è“è‰²çš„ç¬”è®°æœ¬" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/cs-algorithms-merge-sort.html"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&text=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&is_video=false&description=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰&body=Check out this article: https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&name=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&t=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">ğŸ“Œ å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-1-%E6%8A%8A-async-%E8%B0%83%E7%94%A8%E5%8C%85%E8%A3%B9%E5%9C%A8-coroutineScope-%E6%88%96%E4%BD%BF%E7%94%A8-SupervisorJob-%E6%9D%A5%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">2.</span> <span class="toc-text">ğŸ§  1. æŠŠ async è°ƒç”¨åŒ…è£¹åœ¨ coroutineScope æˆ–ä½¿ç”¨ SupervisorJob æ¥å¤„ç†å¼‚å¸¸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A%E5%9C%A8-async-%E4%B8%AD%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E4%BD%86%E5%8F%AA%E7%94%A8-try-catch-%E6%8D%95%E8%8E%B7"><span class="toc-number">2.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try&#x2F;catch æ•è·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%A8%A1%E5%BC%8F-1%EF%BC%9A%E4%BD%BF%E7%94%A8-SupervisorJob"><span class="toc-number">2.2.</span> <span class="toc-text">âœ… æ¨¡å¼ 1ï¼šä½¿ç”¨ SupervisorJob</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%A8%A1%E5%BC%8F-2%EF%BC%88%E6%9B%B4%E6%8E%A8%E8%8D%90%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8-coroutineScope"><span class="toc-number">2.3.</span> <span class="toc-text">âœ… æ¨¡å¼ 2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨ coroutineScope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-2-%E6%A0%B9%E5%8D%8F%E7%A8%8B%E5%BA%94%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-Main-Dispatcher"><span class="toc-number">3.</span> <span class="toc-text">ğŸ¯ 2. æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨ Main Dispatcher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A%E5%9C%A8%E6%A0%B9%E5%8D%8F%E7%A8%8B%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%9D%9E-Main-Dispatcher-%E5%8E%BB%E6%89%A7%E8%A1%8C-UI-%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é Main Dispatcher å»æ‰§è¡Œ UI è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A%E6%A0%B9%E5%8D%8F%E7%A8%8B%E4%BD%BF%E7%94%A8-Main-Dispatcher"><span class="toc-number">3.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨ Main Dispatcher</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%AB-3-%E9%81%BF%E5%85%8D%E6%97%A0%E6%84%8F%E4%B9%89%E7%9A%84-async-await"><span class="toc-number">4.</span> <span class="toc-text">ğŸš« 3. é¿å…æ— æ„ä¹‰çš„ async + await</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">âŒ ä¸æ¨èï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">âœ… æ¨èï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-4-%E9%81%BF%E5%85%8D%E5%8F%96%E6%B6%88%E6%95%B4%E4%B8%AA-scope-%E7%9A%84-Job"><span class="toc-number">5.</span> <span class="toc-text">âš ï¸ 4. é¿å…å–æ¶ˆæ•´ä¸ª scope çš„ Job</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">5.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A"><span class="toc-number">5.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%91-5-%E4%B8%8D%E8%A6%81%E5%9C%A8-suspend-%E5%87%BD%E6%95%B0%E4%B8%AD%E9%9A%90%E5%BC%8F%E4%BE%9D%E8%B5%96%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">ğŸ›‘ 5. ä¸è¦åœ¨ suspend å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A-1"><span class="toc-number">6.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A-1"><span class="toc-number">6.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%8D-6-%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-GlobalScope"><span class="toc-number">7.</span> <span class="toc-text">ğŸŒ 6. é¿å…ä½¿ç”¨ GlobalScope</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A-2"><span class="toc-number">7.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A-2"><span class="toc-number">7.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">ğŸ“Œ æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%81-%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">ğŸ å‚è€ƒ</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wangduwei</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-12-31T09:57:01.000Z" class="dt-published" itemprop="datePublished">2025-12-31</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Kotlin/" rel="tag">Kotlin</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <hr>
<h2 id="ğŸ“Œ-å‰è¨€"><a href="#ğŸ“Œ-å‰è¨€" class="headerlink" title="ğŸ“Œ å‰è¨€"></a>ğŸ“Œ å‰è¨€</h2><p>åœ¨å¼€å§‹ä½¿ç”¨ Kotlin åç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ„è¯†åˆ°ä¸€äº›åº”å½“åšå’Œä¸åº”å½“åšçš„äº‹é¡¹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼‚å¸¸å¤„ç†ã€ä½œç”¨åŸŸç®¡ç†å’Œå¹¶å‘æ¨¡å¼æ–¹é¢ã€‚æœ¬æ–‡æ€»ç»“äº†å¤šç§åç¨‹ä½¿ç”¨ä¸­çš„æ¨¡å¼ä¸åæ¨¡å¼ï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ¸…æ™°ã€å¯ç»´æŠ¤çš„åç¨‹ä»£ç ã€‚</p>
<hr>
<h2 id="ğŸ§ -1-æŠŠ-async-è°ƒç”¨åŒ…è£¹åœ¨-coroutineScope-æˆ–ä½¿ç”¨-SupervisorJob-æ¥å¤„ç†å¼‚å¸¸"><a href="#ğŸ§ -1-æŠŠ-async-è°ƒç”¨åŒ…è£¹åœ¨-coroutineScope-æˆ–ä½¿ç”¨-SupervisorJob-æ¥å¤„ç†å¼‚å¸¸" class="headerlink" title="ğŸ§  1. æŠŠ async è°ƒç”¨åŒ…è£¹åœ¨ coroutineScope æˆ–ä½¿ç”¨ SupervisorJob æ¥å¤„ç†å¼‚å¸¸"></a>ğŸ§  1. æŠŠ <code>async</code> è°ƒç”¨åŒ…è£¹åœ¨ <code>coroutineScope</code> æˆ–ä½¿ç”¨ <code>SupervisorJob</code> æ¥å¤„ç†å¼‚å¸¸</h2><h3 id="âŒ-åæ¨¡å¼ï¼šåœ¨-async-ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨-try-catch-æ•è·"><a href="#âŒ-åæ¨¡å¼ï¼šåœ¨-async-ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨-try-catch-æ•è·" class="headerlink" title="âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try/catch æ•è·"></a>âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try/catch æ•è·</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> job: Job = Job()</span><br><span class="line"><span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default + job)</span><br><span class="line"></span><br><span class="line"><span class="comment">// may throw Exception</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doWork</span><span class="params">()</span></span>: Deferred&lt;String&gt; = scope.async &#123; â€¦ &#125;   <span class="comment">// (1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loadData</span><span class="params">()</span></span> = scope.launch &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        doWork().await()                               <span class="comment">// (2)</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123; â€¦ &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/duweiwang/kotlin-playground/blob/master/src/main/kotlin/com/wangduwei/kotlin/coroutines/ScopeDemo.kt">è¿è¡Œè¿™ä¸ªä»£ç çœ‹æ•ˆæœ</a></p>
<p>è¿™ç§å†™æ³•çœ‹èµ·æ¥åƒåœ¨ try/catch æ•è·å¼‚å¸¸ï¼Œä½†å®ƒ<strong>ä¸ä¼šå¦‚ä½ é¢„æœŸé‚£æ ·å·¥ä½œ</strong>ï¼šå¦‚æœ async æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸æœ€ç»ˆä»ä¼šå¯¼è‡´çˆ¶ä½œç”¨åŸŸå¤±è´¥ã€‚<br>è¿™æ˜¯å› ä¸ºåç¨‹éµå¾ª <em>ç»“æ„åŒ–å¹¶å‘</em> çš„åŸåˆ™ï¼šå­åç¨‹å¤±è´¥ä¼šä¼ æ’­ç»™çˆ¶åç¨‹ã€‚</p>
<h3 id="âœ…-æ¨¡å¼-1ï¼šä½¿ç”¨-SupervisorJob"><a href="#âœ…-æ¨¡å¼-1ï¼šä½¿ç”¨-SupervisorJob" class="headerlink" title="âœ… æ¨¡å¼ 1ï¼šä½¿ç”¨ SupervisorJob"></a>âœ… æ¨¡å¼ 1ï¼šä½¿ç”¨ <code>SupervisorJob</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> scope = CoroutineScope(SupervisorJob() + Dispatchers.Default)</span><br><span class="line">scope.async &#123; â€¦ &#125; <span class="comment">// å¼‚å¸¸ä¸ä¼šå–æ¶ˆåŒçº§åç¨‹</span></span><br></pre></td></tr></table></figure>

<p><code>SupervisorJob</code> èƒ½è®©åŒä¸€å±‚çº§çš„å­åç¨‹å¤±è´¥ä¸ä¼šæ³¢åŠå…¶ä»–åç¨‹ã€‚<br><strong>å¤±è´¥ä¸ä¼šå¯¼è‡´ä¸Šå±‚ä½œç”¨åŸŸå–æ¶ˆ</strong>ã€‚</p>
<h3 id="âœ…-æ¨¡å¼-2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨-coroutineScope"><a href="#âœ…-æ¨¡å¼-2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨-coroutineScope" class="headerlink" title="âœ… æ¨¡å¼ 2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨ coroutineScope"></a>âœ… æ¨¡å¼ 2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨ <code>coroutineScope</code></h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadData</span><span class="params">()</span></span> = coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> deferred = async &#123; â€¦ &#125;</span><br><span class="line">    deferred.await()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æŒ‚èµ·çš„ <code>coroutineScope</code> æŠŠ async åç¨‹åŒ…èµ·æ¥ï¼š</p>
<ul>
<li>ä½¿å¼‚å¸¸èƒ½è¢«æ•è·ï¼›</li>
<li>é™åˆ¶å¤±è´¥åªå½±å“å½“å‰åç¨‹å—ï¼Œä¸ä¼ æ’­åˆ°å¤–éƒ¨ã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</li>
</ul>
<p>æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ <code>async</code> å†…éƒ¨è‡ªå·±å¤„ç†å¼‚å¸¸ã€‚</p>
<hr>
<h2 id="ğŸ¯-2-æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨-Main-Dispatcher"><a href="#ğŸ¯-2-æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨-Main-Dispatcher" class="headerlink" title="ğŸ¯ 2. æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨ Main Dispatcher"></a>ğŸ¯ 2. æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨ Main Dispatcher</h2><h3 id="âŒ-åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é-Main-Dispatcher-å»æ‰§è¡Œ-UI-è°ƒç”¨"><a href="#âŒ-åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é-Main-Dispatcher-å»æ‰§è¡Œ-UI-è°ƒç”¨" class="headerlink" title="âŒ åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é Main Dispatcher å»æ‰§è¡Œ UI è°ƒç”¨"></a>âŒ åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é Main Dispatcher å»æ‰§è¡Œ UI è°ƒç”¨</h3><p>è¿™æ ·å†™éœ€è¦é¢‘ç¹æ‰‹åŠ¨åˆ‡æ¢åˆ° Main å»æ›´æ–° UIï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">scope.launch &#123;</span><br><span class="line">    <span class="comment">// â€¦</span></span><br><span class="line">    withContext(Dispatchers.Main) &#123; <span class="comment">/* update UI */</span> &#125;</span><br><span class="line">    <span class="comment">// â€¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="âœ…-æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨-Main-Dispatcher"><a href="#âœ…-æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨-Main-Dispatcher" class="headerlink" title="âœ… æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨ Main Dispatcher"></a>âœ… æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨ Main Dispatcher</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Main)</span><br><span class="line">scope.launch &#123;</span><br><span class="line">    <span class="comment">// ä¸éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ dispatcher å°±èƒ½æ›´æ–° UI</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¯ä»¥è®©ä»£ç æ›´ç®€æ´ï¼Œé¿å…å¤§é‡æ˜¾å¼åˆ‡æ¢ä¸Šä¸‹æ–‡ã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</p>
<hr>
<h2 id="ğŸš«-3-é¿å…æ— æ„ä¹‰çš„-async-await"><a href="#ğŸš«-3-é¿å…æ— æ„ä¹‰çš„-async-await" class="headerlink" title="ğŸš« 3. é¿å…æ— æ„ä¹‰çš„ async + await"></a>ğŸš« 3. é¿å…æ— æ„ä¹‰çš„ <code>async</code> + <code>await</code></h2><h3 id="âŒ-ä¸æ¨èï¼š"><a href="#âŒ-ä¸æ¨èï¼š" class="headerlink" title="âŒ ä¸æ¨èï¼š"></a>âŒ ä¸æ¨èï¼š</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = async &#123; doWork() &#125;.await()</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å†™æ³•çš„æ•ˆæœç­‰åŒäºç›´æ¥è°ƒç”¨æŒ‚èµ·å‡½æ•°ï¼Œå¹¶ä¸ä¼šå¸¦æ¥å¹¶å‘ä¼˜åŠ¿ã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</p>
<h3 id="âœ…-æ¨èï¼š"><a href="#âœ…-æ¨èï¼š" class="headerlink" title="âœ… æ¨èï¼š"></a>âœ… æ¨èï¼š</h3><p>å¦‚æœä½ åªæ˜¯æƒ³åˆ‡æ¢æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ <code>withContext</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = withContext(Dispatchers.IO) &#123;</span><br><span class="line">    doWork()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>async</code> æ›´é€‚åˆç”¨äºå¤šä¸ªåç¨‹å¹¶è¡Œå¯åŠ¨ï¼Œå†ä¸€èµ· awaitã€‚</p>
<hr>
<h2 id="âš ï¸-4-é¿å…å–æ¶ˆæ•´ä¸ª-scope-çš„-Job"><a href="#âš ï¸-4-é¿å…å–æ¶ˆæ•´ä¸ª-scope-çš„-Job" class="headerlink" title="âš ï¸ 4. é¿å…å–æ¶ˆæ•´ä¸ª scope çš„ Job"></a>âš ï¸ 4. é¿å…å–æ¶ˆæ•´ä¸ª scope çš„ Job</h2><h3 id="âŒ-åæ¨¡å¼ï¼š"><a href="#âŒ-åæ¨¡å¼ï¼š" class="headerlink" title="âŒ åæ¨¡å¼ï¼š"></a>âŒ åæ¨¡å¼ï¼š</h3><p>å¦‚æœä½ è°ƒç”¨æ•´ä¸ª scope çš„ <code>job.cancel()</code>, é‚£ä¸ª scope ä¼šè¿›å…¥ completed çŠ¶æ€ã€‚<br>æ­¤ååœ¨è¯¥ scope ä¸­å¯åŠ¨çš„åç¨‹å°†ä¸ä¼šæ‰§è¡Œã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</p>
<h3 id="âœ…-æ¨èåšæ³•ï¼š"><a href="#âœ…-æ¨èåšæ³•ï¼š" class="headerlink" title="âœ… æ¨èåšæ³•ï¼š"></a>âœ… æ¨èåšæ³•ï¼š</h3><p>ä½¿ç”¨ <code>cancelChildren()</code> æ¥å–æ¶ˆå½“å‰ scope ä¸‹çš„æ‰€æœ‰å­åç¨‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scope.coroutineContext.cancelChildren()</span><br></pre></td></tr></table></figure>

<p>å¹¶é€‚å½“ä¸ºæ¯ä¸ªåç¨‹å•ç‹¬æ§åˆ¶å–æ¶ˆé€»è¾‘ã€‚</p>
<hr>
<h2 id="ğŸ›‘-5-ä¸è¦åœ¨-suspend-å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨"><a href="#ğŸ›‘-5-ä¸è¦åœ¨-suspend-å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨" class="headerlink" title="ğŸ›‘ 5. ä¸è¦åœ¨ suspend å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨"></a>ğŸ›‘ 5. ä¸è¦åœ¨ suspend å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨</h2><h3 id="âŒ-åæ¨¡å¼ï¼š-1"><a href="#âŒ-åæ¨¡å¼ï¼š-1" class="headerlink" title="âŒ åæ¨¡å¼ï¼š"></a>âŒ åæ¨¡å¼ï¼š</h3><p>å¦‚æœ suspend å‡½æ•°å†…éƒ¨ç›´æ¥è®¿é—® UIï¼Œä¼šå¯¼è‡´åœ¨é Main dispatcher æŠ›å‡ºå¼‚å¸¸ï¼ˆå¦‚ Android çš„ <code>CalledFromWrongThreadException</code>ï¼‰ã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</p>
<h3 id="âœ…-æ¨èåšæ³•ï¼š-1"><a href="#âœ…-æ¨èåšæ³•ï¼š-1" class="headerlink" title="âœ… æ¨èåšæ³•ï¼š"></a>âœ… æ¨èåšæ³•ï¼š</h3><p>è®© suspend å‡½æ•°å¯¹è°ƒåº¦å™¨é€æ˜ï¼Œåœ¨å†…éƒ¨ä½¿ç”¨ <code>withContext</code> åšå¿…è¦çš„è°ƒåº¦ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">()</span></span> = withContext(Dispatchers.Main) &#123;</span><br><span class="line">    <span class="comment">// UI æ“ä½œå®‰å…¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·è¯¥å‡½æ•°å°±èƒ½åœ¨ä»»æ„ dispatcher è°ƒç”¨ï¼Œè€Œä¸ä¼šå‡ºé”™ã€‚(<a target="_blank" rel="noopener" href="https://onlyfor-me-blog.tistory.com/506">onlyfor-me-blog.tistory.com</a>)</p>
<hr>
<h2 id="ğŸŒ-6-é¿å…ä½¿ç”¨-GlobalScope"><a href="#ğŸŒ-6-é¿å…ä½¿ç”¨-GlobalScope" class="headerlink" title="ğŸŒ 6. é¿å…ä½¿ç”¨ GlobalScope"></a>ğŸŒ 6. é¿å…ä½¿ç”¨ <code>GlobalScope</code></h2><h3 id="âŒ-åæ¨¡å¼ï¼š-2"><a href="#âŒ-åæ¨¡å¼ï¼š-2" class="headerlink" title="âŒ åæ¨¡å¼ï¼š"></a>âŒ åæ¨¡å¼ï¼š</h3><p>åˆ°å¤„ä½¿ç”¨ <code>GlobalScope</code> å¯åŠ¨åç¨‹ä¼šè®©åç¨‹è„±ç¦»ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚<br>è¿™ä¼šå¯¼è‡´èµ„æºæ³„éœ²ä¸ä¸å¯é¢„æµ‹è¡Œä¸ºï¼Œå°¤å…¶åœ¨ Android ä¸­å¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„éœ²ã€æœªå–æ¶ˆåç¨‹ç­‰é—®é¢˜ã€‚(<a target="_blank" rel="noopener" href="https://discuss.kotlinlang.org/t/unavoidable-memory-leak-when-using-coroutines/11603/4">discuss.kotlinlang.org</a>)</p>
<h3 id="âœ…-æ¨èåšæ³•ï¼š-2"><a href="#âœ…-æ¨èåšæ³•ï¼š-2" class="headerlink" title="âœ… æ¨èåšæ³•ï¼š"></a>âœ… æ¨èåšæ³•ï¼š</h3><p>åœ¨ Android ä¸­ï¼Œåç¨‹åº”è¯¥ç»‘å®šåˆ° Activity/Fragment/ViewModel ç”Ÿå‘½å‘¨æœŸï¼Œä¾‹å¦‚ä½¿ç”¨ï¼š</p>
<ul>
<li><code>viewModelScope</code> / <code>lifecycleScope</code></li>
<li>è‡ªå®šä¹‰å¸¦æœ‰ <code>SupervisorJob</code> çš„ CoroutineScope</li>
</ul>
<hr>
<h2 id="ğŸ“Œ-æ€»ç»“"><a href="#ğŸ“Œ-æ€»ç»“" class="headerlink" title="ğŸ“Œ æ€»ç»“"></a>ğŸ“Œ æ€»ç»“</h2><table>
<thead>
<tr>
<th>ä¸»é¢˜</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td>å¼‚å¸¸å¤„ç†</td>
<td>ç”¨ <code>coroutineScope</code> æˆ– <code>SupervisorJob</code>ï¼Œä¸è¦ç®€å• try/catch</td>
</tr>
<tr>
<td>æ ¹åç¨‹ Dispatcher</td>
<td>ä¼˜å…ˆä½¿ç”¨ Main</td>
</tr>
<tr>
<td>async/await</td>
<td>é¿å… immediate awaitï¼Œç”¨äºå¹¶å‘åœºæ™¯</td>
</tr>
<tr>
<td>å–æ¶ˆåç¨‹</td>
<td>ä¸è¦å–æ¶ˆæ•´ä¸ª scope Jobï¼Œç”¨ <code>cancelChildren()</code></td>
</tr>
<tr>
<td>suspend å‡½æ•°</td>
<td>ä¸è¦ä¾èµ–éšå¼ dispatcher</td>
</tr>
<tr>
<td>GlobalScope</td>
<td>é¿å…ä½¿ç”¨ï¼Œç»‘å®šç”Ÿå‘½å‘¨æœŸ</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ-å‚è€ƒ"><a href="#ğŸ-å‚è€ƒ" class="headerlink" title="ğŸ å‚è€ƒ"></a>ğŸ å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://proandroiddev.com/kotlin-coroutines-patterns-anti-patterns-f9d12984c68e">åŸæ–‡</a></p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>åŠ è½½è¯„è®ºéœ€è¦åœ¨æµè§ˆå™¨å¯ç”¨ JavaScript è„šæœ¬æ”¯æŒã€‚</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">ğŸ“Œ å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A0-1-%E6%8A%8A-async-%E8%B0%83%E7%94%A8%E5%8C%85%E8%A3%B9%E5%9C%A8-coroutineScope-%E6%88%96%E4%BD%BF%E7%94%A8-SupervisorJob-%E6%9D%A5%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span class="toc-number">2.</span> <span class="toc-text">ğŸ§  1. æŠŠ async è°ƒç”¨åŒ…è£¹åœ¨ coroutineScope æˆ–ä½¿ç”¨ SupervisorJob æ¥å¤„ç†å¼‚å¸¸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A%E5%9C%A8-async-%E4%B8%AD%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E4%BD%86%E5%8F%AA%E7%94%A8-try-catch-%E6%8D%95%E8%8E%B7"><span class="toc-number">2.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼šåœ¨ async ä¸­æŠ›å‡ºå¼‚å¸¸ä½†åªç”¨ try&#x2F;catch æ•è·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%A8%A1%E5%BC%8F-1%EF%BC%9A%E4%BD%BF%E7%94%A8-SupervisorJob"><span class="toc-number">2.2.</span> <span class="toc-text">âœ… æ¨¡å¼ 1ï¼šä½¿ç”¨ SupervisorJob</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%A8%A1%E5%BC%8F-2%EF%BC%88%E6%9B%B4%E6%8E%A8%E8%8D%90%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8-coroutineScope"><span class="toc-number">2.3.</span> <span class="toc-text">âœ… æ¨¡å¼ 2ï¼ˆæ›´æ¨èï¼‰ï¼šä½¿ç”¨ coroutineScope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AF-2-%E6%A0%B9%E5%8D%8F%E7%A8%8B%E5%BA%94%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-Main-Dispatcher"><span class="toc-number">3.</span> <span class="toc-text">ğŸ¯ 2. æ ¹åç¨‹åº”ä¼˜å…ˆä½¿ç”¨ Main Dispatcher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A%E5%9C%A8%E6%A0%B9%E5%8D%8F%E7%A8%8B%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%9D%9E-Main-Dispatcher-%E5%8E%BB%E6%89%A7%E8%A1%8C-UI-%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼šåœ¨æ ¹åç¨‹ä¸­ä½¿ç”¨é Main Dispatcher å»æ‰§è¡Œ UI è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A%E6%A0%B9%E5%8D%8F%E7%A8%8B%E4%BD%BF%E7%94%A8-Main-Dispatcher"><span class="toc-number">3.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼šæ ¹åç¨‹ä½¿ç”¨ Main Dispatcher</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%AB-3-%E9%81%BF%E5%85%8D%E6%97%A0%E6%84%8F%E4%B9%89%E7%9A%84-async-await"><span class="toc-number">4.</span> <span class="toc-text">ğŸš« 3. é¿å…æ— æ„ä¹‰çš„ async + await</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">âŒ ä¸æ¨èï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">âœ… æ¨èï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-4-%E9%81%BF%E5%85%8D%E5%8F%96%E6%B6%88%E6%95%B4%E4%B8%AA-scope-%E7%9A%84-Job"><span class="toc-number">5.</span> <span class="toc-text">âš ï¸ 4. é¿å…å–æ¶ˆæ•´ä¸ª scope çš„ Job</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">5.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A"><span class="toc-number">5.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%91-5-%E4%B8%8D%E8%A6%81%E5%9C%A8-suspend-%E5%87%BD%E6%95%B0%E4%B8%AD%E9%9A%90%E5%BC%8F%E4%BE%9D%E8%B5%96%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">ğŸ›‘ 5. ä¸è¦åœ¨ suspend å‡½æ•°ä¸­éšå¼ä¾èµ–è°ƒåº¦å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A-1"><span class="toc-number">6.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A-1"><span class="toc-number">6.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%8D-6-%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-GlobalScope"><span class="toc-number">7.</span> <span class="toc-text">ğŸŒ 6. é¿å…ä½¿ç”¨ GlobalScope</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9D%8C-%E5%8F%8D%E6%A8%A1%E5%BC%8F%EF%BC%9A-2"><span class="toc-number">7.1.</span> <span class="toc-text">âŒ åæ¨¡å¼ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%9C%85-%E6%8E%A8%E8%8D%90%E5%81%9A%E6%B3%95%EF%BC%9A-2"><span class="toc-number">7.2.</span> <span class="toc-text">âœ… æ¨èåšæ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C-%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">ğŸ“Œ æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%81-%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">ğŸ å‚è€ƒ</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&text=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&is_video=false&description=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰&body=Check out this article: https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&title=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&name=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://wangduwei.top/kotlin-coroutine-pattern-antipattern.html&t=ã€ç¿»è¯‘ã€‘Kotlin åç¨‹ æ¨¡å¼ä¸ åæ¨¡å¼ï¼ˆPatterns &amp; Antiâ€‘Patternsï¼‰"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    wangduwei
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?9f3c7bb2232e1e3fda4c019e4a4406c0";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'duweiwang/comments';
      var utterances_issue_term = 'title';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
